# 2.1 Installing Express
(1) node jsíŒŒì¼ëª… --> ì´ ë°©ë²•ìœ¼ë¡œë„ jsíŒŒì¼ì„ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆë‹¤
(2) ì´ë²ˆ í”„ë¡œì íŠ¸ì—ì„œëŠ” package.jsonìœ¼ë¡œ ì‹¤í–‰ í•´ ì¤„ê²ƒì´ë‹¤
(3) package.json ì•ˆì— main --> ë‚´ê°€ ë§Œë“¤ê³  ë°°í¬í•œ packageë¥¼ ë‹¤ë¥¸ ì‚¬ëŒë“¤ì´ ì„¤ì¹˜í•˜ë©´ mainì„ ì‚¬ìš©í•œë‹¤(ì´ë²ˆ í”„ë¡œì íŠ¸ì—ì„œëŠ” í•„ìš”ì—†ìŒ)
(4) package.json ì•ˆì— scriptsë¥¼ ë§Œë“¤ì–´ ì¤€ë‹¤
(5) scripts ëŠ” ì‹¤í–‰í•˜ê³  ì‹¶ì„ ê²ƒì„ ë§í•œë‹¤ ì¦‰, scriptsì•ˆì— ì‹¤í–‰í•  ê²ƒì„ ì ì–´ì¤€ë‹¤
ex) scripts={
"start": "node index.js" // ì´ë¦„ì€ ììœ ë¡­ê²Œ ì§€ì–´ì¤„ ìˆ˜ ìˆë‹¤
}
(6) ê·¸ í›„ npm run start ë¡œ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆë‹¤ // package.jsonì´ ì¡´ì¬í•˜ëŠ” í´ë” í•œì •
(7) npm install express ë¡œ Express íŒ¨í‚¤ì§€ë¥¼ ë‹¤ìš´ë¡œë“œ ë°›ëŠ”ë‹¤
(8) node_modules, package-lock.json íŒŒì¼ì´ ìƒì„±ë„ë‹ˆë‹¤
(9) node_modules ì—ëŠ” npmìœ¼ë¡œ ì„¤ì¹˜í•œ ëª¨ë“  íŒ¨í‚¤ì§€ê°€ ì €ì¥ëœë‹¤
(10) express ëŠ” í˜¼ì ì‘ë™ë˜ì§€ ì•Šê¸°ì— ë‹¤ë¥¸ íŒ¨í‚¤ì§€ê°€ í•„ìš”í•˜ë‹¤
(11) node_modules ì•ˆì— express ì•ˆì— ì¡´ì¬í•˜ëŠ” package.jsonì•ˆì— dependenciesëŠ” expressê°€ ì‘ë™ë˜ê¸°ìœ„í•´ í•„ìš”í•œ íŒ¨í‚¤ì§€ë“¤ì„ ë‚˜íƒ€ë‚¸ë‹¤
(12) expressë¥¼ ì„¤ì¹˜í•˜ëŠ”ë° ì˜ì¡´í•˜ê³  ìˆëŠ” íŒ¨í‚¤ì§€ê°€ ìˆê¸° ë•Œë¬¸ì— npm i expressë¥¼ í•˜ë©´ ê·¸ê²ƒë“¤ë„ í•¨ê»˜ ì„¤ì¹˜ëœë‹¤
(13) npm i express ë¥¼ í–ˆì„ ë•Œ npm ì´ ì•Œì•„ì„œ dependenciesì— expressë¥¼ ì¶”ê°€í•´ì¤€ë‹¤

#2.2
npm i express
- Created node_modules and package-lock.json and we deleted them
- We're going to install express again but now we are not going to run npm i express
-- We're going to run "npm i" only => We have node_modules and package.json again
--> npm is very smart and it looks at your package.json and finds there is a dependencies entry. And it looks at the dependencies and npm installs them for you
--> package.json is important b/c now it stores the info that our project needs to run
- Very good b/c when you're working on a NodeJS project with a team or changing computers
-- You do not want to upload node_modules to your GitHub
-- node_modules can get super heavy
-- If you want to give to your friend, all you have to do is copy package.json and index.js and that's it. You don't have to copy node_modules
- package-lock: keeps your packages very secure
-- Checks packages haven't been modified and checks with a hash --> really safe
-- Basically locked
-- Important b/c if my project works with package-lock and package.json, when your friend installs express again from the package.json, if you give package.json, package-lock.json, and index.js to your friend, and they run "npm i" only. Then, you're going to be sure that they got the exact same version number on everything.
--> Very useful b/c that means your code is going to run for sure
- We want to be very precise with the version numbers in package-lock.json
-- But we don't have to manage any of this. This is done automatically for us by npm
.gitignore file: Hide your node_modules from your GitHub
- Add "/node_modules"
Reason why you should close package.json
- Some people have trouble when they do "npm i"
- b/c if your package.json is open and you haven't saved and you run "npm i express"
=> npm is going to modify your package.json b/c npm is going to try to add dependencies to pacakge.json
- But b/c you haven't saved, there will be like a conflict on versions
--> Every time you're going to run "npm install", make sure that you close or save your package.json
Remember: Dependencies are what makes your project run
- And you don't have to send your friend the node_modules folder

# 2.3
NodeJSì—ì„œ í•„ìš”í•œ babelì„¤ì¹˜
npm install --save-dev @babel/core
npm install @babel/preset-env --save-dev

babel.config.jsoníŒŒì¼ ìƒì„±
```
{
"presets": ["@babel/preset-env"]
}
```
https://babeljs.io/setup#installation

@babel/preset-env
@babel/preset-envëŠ” í™˜ê²½ì— í•„ìš”í•œ êµ¬ë¬¸ ë³€í™˜ì„ ì„¸ë¶€ì ìœ¼ë¡œ ê´€ë¦¬í•  í•„ìš” ì—†ì´ ìµœì‹  JavaScriptë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ìŠ¤ë§ˆíŠ¸í•œ presetì…ë‹ˆë‹¤.
https://babeljs.io/docs/en/babel-preset-env

dependencies = í”„ë¡œì íŠ¸ì— í•„ìš”í•œê²ƒë“¤ ë‹¤ìš´(í•„ìˆ˜)
devDependencies = í”„ë¡œê·¸ë˜ë¨¸ê°€ ë” í¸í•˜ê²Œ ì½”ë“œë¥¼ ì§¤ìˆ˜ìˆê²Œ ë„ì™€ì£¼ëŠ” ë³´ì¡°íˆ´(ë³´ì¡°)

#2.4
//nodeJSê°€ ì´í•´í•˜ëŠ” ì½”ë“œë¥¼ ì“°ê±°ë‚˜ babelì„ ì‚¬ìš©í•œë‹¤.
// babelì€ ìš°ë¦¬ê°€ ì‘ì„±í•œ ìµœì‹  ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì»´íŒŒì¼ í•´ì¤€ë‹¤.
// ì´ ë§ì€ nodeJSê°€ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¬¸ì œì—†ì´ ì´í•´í•˜ë„ë¡ ë³€í™˜í•´ì¤€ë‹¤ëŠ” ëœ»ì´ë‹¤.
// pacakge.jsonì€ í…ìŠ¤íŠ¸ íŒŒì¼ì¸ë° devDependenciesëŠ” ê°œë°œìê°€ í•„ìš”í•œ ì„¤ì •ì¸ë°
dependenciesëŠ” ë¬´ìŠ¨ í”„ë¡œì íŠ¸ë¥¼ ì‚¬ìš©í•  ì§€ ì•Œë ¤ì£¼ëŠ”ë° devDependenciesëŠ”
 í”„ë¡œì íŠ¸ë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•œ dependenciesë¡œ ìë™ì°¨ë¡œ ë”°ì§€ë©´ ê°€ì†”ë¦°ê³¼ ê°™ì€ ì¡´ì¬ì´ë‹¤. 
 devDependenciesëŠ” ë‚´ê°€ ìš´ì „ì„ ë” ì˜í•˜ë ¤ë©´ ìŒì•…ì´ ìˆì–´ì•¼ í•˜ëŠ” ê²ƒê³¼ ë¹„ìŠ·í•˜ë‹¤.
  í•˜ë‚˜ëŠ” ê°œë°œìì—ê²Œ, ë‹¤ë¥¸ í•˜ë‚˜ëŠ” í”„ë¡œì íŠ¸ í•„ìš”í•œ ê²ƒìœ¼ë¡œ ê°œë°œìì—ê²Œ babelì´ í•„ìš”í•˜ë‹¤. 
  babelì´ devDependenciesì— ë“¤ì–´ê°€ë©´ ëª¨ë“  ê±´ node_modulesì— ë“¤ì–´ê°€ë¯€ë¡œ npm install --save-dev @babel/coreì—ì„œ
   --save-devë¥¼ ì§€ìš°ê³  npm install @babel/coreë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤. ë‹¤ë¥¸ ê³³ì— ìƒê¸´ë‹¤ë©´ ê·¸ëƒ¥ ì˜®ê¸°ë©´ ëœë‹¤.
    babel.config.json configuration fileì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
     ê¼­, package.json íŒŒì¼ì„ ë‹«ê±°ë‚˜ ì €ì¥ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ì•¼í•œë‹¤.
      babelì„ ì´ìš©í•´ì„œ ìµœì‹  ë¬¸ë²• ì½”ë“œë¥¼ ì“¸ ìˆ˜ ìˆëŠ”ë° babelì„ ì„¤ì •í•´ ì¤„ í•„ìš”ê°€ ìˆë‹¤.
       babel.config.jsonì„ ë§Œë“¤ë©´ babelì´ ì•Œì•„ì„œ ì´ íŒŒì¼ì„ ì°¾ê³  ë‚´ìš©ì„ ë“¤ì—¬ë‹¤ ë³¸ë‹¤.
        presetsì€ babelì„ ìœ„í•œ ì—„ì²­ ê±°ëŒ€í•œ í”ŒëŸ¬ê·¸ì¸ì¸ë° preset-envê°€ ê°€ì¥ ìœ ëª…í•˜ë‹¤.
         smart presetì„ ì‚¬ìš©í•˜ë©´ ìµœì‹  ìë°”ìŠ¤í¬ë¦½íŠ¸ ë¬¸ë²•ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
          presetì—ëŠ” ì¢…ë¥˜ê°€ ì—„ì²­ ë§ì€ë°, ê·¸ ì¤‘ì— babel/preset-react, babel/preset-typescript ë“±ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
           presetì€ í”ŒëŸ¬ê·¸ì¸ì„ ì•Œë©´ ë˜ëŠ”ë° preset-envëŠ” ìµœì‹  ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì“¸ ìˆ˜ ìˆë‹¤.
            babel.config.json íŒŒì¼ì„ ë§Œë“¤ì–´ì„œ ë‚´ìš©ì„ ë¶™ì—¬ë„£ê¸° í•˜ë©´ ë˜ëŠ”ë° @babel/coreì™€ @bable/preset-envë¥¼ ì„¤ì •í•´ì•¼ í•œë‹¤.

#3.0
Make a src folder and all my application (the ones that have code and all the logic: index.js currently) is going to live inside of src
=> Change package.json:
"scripts": {
"dev": "nodemon --exec babel-node src/index.js"
},

The file name doesn't have to be named index.js
- For this, change to server.js and change package.json:
"scripts": {
"dev": "nodemon --exec babel-node src/server.js"
},

=> In server.js:
import express from "express"; // import the package called express from "express"
- NodeJS and npm are so smart that they know that when I do this, I'm looking for express in the node_modules
--> So you don't need to say node_modules/express
- npm and NodeJS are going to search for express in node_modules until they find it and they are going to call index.js
- You don't need to worry node_modules b/c you're not going to write this anywhere in your life

How do we use express:
1) Create an express application
const app = express();
2) Now your application needs to listen
- What is a server?
-- A server is a computer that is always online
-- Most of the time, it doesn't even have a screen or keyboard
-- It's listening to request
--- Request: just a connection
-- You send a message to the server, and the server sends that message to me --> Request
-- Server listens and responses
-- We need to make the server wait for people to ask for stuff
--> `app.listen()`
-- listen() has a callback
--- callback here: the function that will happen when our server starts
--- Before writing the callback, first we need to tell the server what port the server is going to be listening to
---- b/c your computer has many ports
---- port: like a door or window into your computer
---- some ports are open to the Internet

Our server is going to be listening to our port
- The high number ports are always available
app.listen({port number}, callbackFunc); --> we use 4000 as the port number here (not required)

How to go to a server
- When you start a server in your computer, usually that server can be accessed through localhost
http://localhost:4000/

To kill your server and nodemon: ctrl/command + c
- When you kill the server, the localhost refused to connect

import express from "express";

const PORT = 4000;

const app = express();

const handleListening = () =>
console.log(`âœ… Server listening on port http://localhost:${PORT} ğŸš€`);

app.listen(PORT, handleListening);

#3.1
1. Once you create a server, you need to make server respond to user requests.
2. Users request using HTTP protocol. This request is called GET request.
3. When they type in the URL in the address bar and the page loads, they are actually sending a GET request to a server, getting a response and displaying a response on the browser.
I hope this helps and I wish you guys the best! :)

#3.2
1. In order to make a server respond to a GET request from a user's browser, set up .get() that takes in a "home URL" and "eventHandler function" as below:
const handleHome = () => console.log("Somebody is trying to go home.");
app.get("/", handleHome);
2. Having these codes in a server.js (has to placed after express server initiates), it will know how to respond to GET requests from users. However, since EventHandler does not return anything, it will keep the browser loading, waiting for a response from the server.
I hope this helps! God bless you all! :)

#3.3
1. Though setting up .get("URL", "GET handler function") will handle a Get request, it will not respond to a GET reqeust.
2. In order to make a server respond to a user's GET request, you need to modify the EventHandler function into an arrow function. Then, make the response argument .end() or .send() as below:
const handleHome = (req, res) => {
return res.send("I still love you.");
};
3. The first argument inside GET handler function is usually named "req," it takes in a request object.
4. The second argument is usually named "res," and it takes in a response object.
5. res.end() will end the response without returning anything; res.send() will return an input to the user's browser. For this particular example, the user will see a string "I still love you." on their browser when they request for a home ("/") URL page to a server.
I hope this helps! Good luck to you all! :)

#3.4
app.get(path, callback [, callback ...])
ì§€ì •ëœ ì½œë°± í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ HTTP GET ìš”ì²­ì„ ì§€ì •ëœ ê²½ë¡œë¡œ ë¼ìš°íŒ…í•©ë‹ˆë‹¤.

Request
req ê°ì²´ëŠ” HTTP requestë¥¼ ë‚˜íƒ€ë‚´ë©° ìš”ì²­ query string, parameters, body, HTTP headers ë“±ì— ëŒ€í•œ ì†ì„±ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.

Response
res ê°ì²´ëŠ” Express ì•±ì´ HTTP requestë¥¼ ë°›ì„ ë•Œ ë³´ë‚´ëŠ” HTTP responseë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

https://expressjs.com/ko/4x/api.html#express.json

#3.5
-middlewareëŠ” reqeust,response ì‚¬ì´ì—ìˆëŠ” ì†Œí”„íŠ¸ì›¨ì–´ì´ë‹¤.
-ëª¨ë“  controller,handlerëŠ” middlewareì´ë‹¤.
-middlewareì—ëŠ” controllerì™€ê°™ì€ 2ê°œì˜ argumentì™¸ì— í•œê°œê°€ ë”ìˆë‹¤. req, res, ê·¸ë¦¬ê³  next
 next();ë¥¼í˜¸ì¶œí•˜ì—¬ ë‹¤ìŒ ë©”ì†Œë“œë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ”ê²ƒì´ middlewareì´ë‹¤.
 middlewareëŠ” ì ˆëŒ€ë¡œ reqì—ëŒ€í•´ responseí•˜ì§€ì•ŠëŠ”ë‹¤.
 ->returnì€ responseí•œë’¤ ì„œë²„ ì—°ê²°ì„ ëŠê¸°ë•Œë¬¸ì´ë‹¤.

#3.7
setup Recap
pacakge.json = scriptsì•ˆì— ì‹¤í–‰ì–´ë¥¼ ì €ì¥í•˜ì—¬ í¸í•˜ê²Œ ì‹¤í–‰
dependencies,devDependencies = í•„ìš”í•œ íˆ´ë“¤ì„ ì €ì¥í•˜ì—¬
node_modulesì— ì €ì¥í•˜ê²Œ ë„ì™€ì¤Œ. ì‹¤í–‰ì–´ëŠ” npm i

devDependencies
 -nodemon => ì €ì¥ì‹œ ë³€í™”ê°€ìˆì„ë•Œ scripts ì»¤ë§¨ë“œë¥¼ ìë™ì‹¤í–‰
 -bable-node => ES6ë“± ìµœì‹ ì½”ë“œë¥¼ ì“°ê³ ì‹¶ì„ë•Œ node.jsê°€ ì´í•´í• ìˆ˜ìˆê²Œ JavaScriptë¥¼ ë°”ê¿”ì¤Œ
  bable.config.json => babe-nodeë¥¼ ì“¸ë•Œ ë§Œë“¤ì–´ì„œ í•„ìš”í•œ í”ŒëŸ¬ê·¸ì¸ ì •ë³´ë¥¼ ë„£ìŒ.


#3.8
Server Recap
-Server : requestë¥¼ listeningí•˜ê³ ìˆëŠ” ì»´í“¨í„°
í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ëŠ” ê°œë°©ëœ í¬íŠ¸ë¥¼ í†µí•´ request ì™€ response ë¥¼ ì£¼ê³ ë°›ëŠ”ë‹¤.
 ->ë¸Œë¼ìš°ì €ëŠ” ì„œë²„ì—ê²Œ í˜ì´ì§€ë¥¼ requestí•œë‹¤(í˜ì´ì§€ë¥¼ getí•œë‹¤).
 get requestì— ë°˜ì‘í•˜ê¸°ìœ„í•´ì„œëŠ”
 app.get("/", handleHome); "/"ë¥¼ ë¼ìš°í„°ë¼ê³  í•œë‹¤.

#3.9
controller Recap
HTTP request ëŠ” ì–´ë–¤ route(url) ì— ëŒ€í•œ HTTP Method ìš”ì²­ì´ê³  ì„œë²„ëŠ” ê·¸ ìš”ì²­ì— ëŒ€í•œ response ë¥¼ í•´ì£¼ì–´ì•¼í•œë‹¤. ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ê²ƒì´ ë˜ **controller**ì´ë‹¤.
# controller
ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì „ë‹¬ë°›ì€ requestë¥¼ ì²˜ë¦¬í•˜ê³  responseë¥¼ ì „ë‹¬í•˜ê¸° ìœ„í•œ ì½œë°±í•¨ìˆ˜ì´ë‹¤.
requestê°€ ì™”ìœ¼ë©´ responseí•´ì¤˜ì•¼ í•œë‹¤.
controllerëŠ” í•­ìƒ req,resë¥¼ ì•„ê·œë¨¼íŠ¸ë¡œ ê°€ì§„ë‹¤.
req,resì—ëŠ” ë§ì€ ë©”ì†Œë“œê°€ ìˆë‹¤.
 ->res.send()ë‚˜ res.end() ë“±ìœ¼ë¡œ respondí•´ì¤˜ì•¼í•œë‹¤.

#3.10
middleware
 requestì™€ responseì˜ ì¤‘ê°„ì— ìˆëŠ” ì†Œí”„íŠ¸ì›¨ì–´ì´ë‹¤.
 app.get("/",middleware, handleHome)
 ë¯¸ë“¤ì›¨ì–´ëŠ” request ì˜¤ë¸Œì íŠ¸ì™€, response ì˜¤ë¸Œì íŠ¸ ë§ê³ ë„ next íŒŒë¼ë¯¸í„°ë¥¼ ê°–ëŠ”ë‹¤.
 next íŒŒë¼ë¯¸í„°ëŠ” ë‹¤ìŒìœ¼ë¡œ request ë¥¼ ì²˜ë¦¬í•  ì½œë°±í•¨ìˆ˜ë¥¼ ë‹´ê³ ìˆë‹¤.
ë¯¸ë“¤ì›¨ì–´ë¥¼ ê¸€ë¡œë²Œí•˜ê²Œ ì‚¬ìš©í•˜ëŠ”ë²•
app.use(ë¯¸ë“¤ì›¨ì–´1,ë¯¸ë“¤ì›¨ì–´2...)ë¥¼ ë§Œë“¤ì–´ get("/", ...)ë³´ë‹¤ ìœ„ì— ë‘”ë‹¤.

#3.11
morgan
 -morgan íŒ¨í‚¤ì§€ëŠ” node.js ì„œë²„ë¡œ êµ¬ì„±ëœ ì›¹ í™˜ê²½ì—ì„œ
  HTTP request ë¡œê·¸ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ë¯¸ë“¤ì›¨ì–´ì´ë‹¤.
npm i morganìœ¼ë¡œ ì„¤ì¹˜í•œí›„
import morgan from "morgan"ìœ¼ë¡œ ë¶€ë¥¸í›„ ì‚¬ìš©í•œë‹¤.
 ->ì‚¬ìš©ë²•ì€ app.use(morgan("dev..")) ë“±ìœ¼ë¡œ
 morgan()ì´ ë¯¸ë“¤ì›¨ì–´ë¥¼ returní•´ì¤€ë‹¤. ì•„ê·œë¨¼íŠ¸ëŠ” 5ì¢…ë¥˜ìˆë‹¤.

#4.0
ë¼ìš°í„°
 ë¼ìš°í„°ëŠ” urlì´ ì–´ë–»ê²Œ ì‹œì‘í•˜ëŠ”ì§€ì— ë”°ë¼ ë‚˜ëˆ„ëŠ” ë°©ë²•
 ë¼ìš°í„°ëŠ” ì‘ì—…ì¤‘ì¸ ì£¼ì œë¥¼ ê¸°ë°˜ìœ¼ë¡œ URLì„ ê·¸ë£¹í™”í•œë‹¤
 /users/edit -> Edit user
 /videos/watch -> Watch Video

#4.1
 ë¼ìš°í„°ì˜ ê·¸ë£¹í™” ê·œì¹™ì— ë”°ë¥´ë©´ ë¡œê·¸ì¸í˜ì´ì§€ëŠ” 
 /users/loginì´ì–´ì•¼ í•œë‹¤. ìœ ì €ê°€ ë¡œê·¸ì¸í•˜ê¸°ë•Œë¬¸ì´ë‹¤.
 í•˜ì§€ë§Œ ë•Œë•Œë¡œ í¸ì˜ì„±ì„ìœ„í•´ ì˜ˆì™¸ë¥¼ ë‘ê¸°ë„í•œë‹¤.
 /loginì´ ë” ê¹”ë”í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

** ìœ ì €ì˜ req-> ì„œë²„ res íë¦„
ìœ ì €ê°€ /videosë¡œ ì‹œì‘í•˜ëŠ” urlì— ë“¤ì–´ê°€ë©´
expressëŠ” videoë¼ìš°í„°ì— ë“¤ì–´ê°€ì„œ, urlì˜ ë‚˜ë¨¸ì§€ì£¼ì†Œë¥¼ ì°¾ëŠ”ë‹¤.

#4.2
server.jsì— ë¼ìš°í„°ë¥¼ ë‹¤ ëª¨ì•„ë†“ìœ¼ë©´ ë³´ê¸°ì•ˆì¢‹ìœ¼ë‹ˆ ì •ë¦¬í•œë‹¤.
global,user,videoë¼ìš°í„° ê° 3ê°œì˜ í´ë”ë¡œ ë‚˜ëˆˆë‹¤.
ê·¸ëŸ¼ server.jsì—ì„œ ê° ë¼ìš°í„°ë¥¼ ëª»ì°¾ì„í…ë° ê°ê°ì„ importí•´ì¤˜ì•¼í•œë‹¤.
 í”„ë¡œì íŠ¸ì— ìˆëŠ” ëª¨ë“  íŒŒì¼ì€ ë¶„ë¦¬ëœ ëª¨ë“ˆì´ë‹¤.
 ë‹¤ë¥¸ íŒŒì¼ì—ì„œ ì“¸ë•ŒëŠ” ê·¸ íŒŒì¼ì—ì„œ export, ì“¸íŒŒì¼ì—ì„œ importí•´ì•¼í•œë‹¤.

#4.3
 ë¼ìš°í„°ì™€ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ê°™ì€íŒŒì¼ì— ì“°ëŠ”ê²ƒì€ ì¢‹ì§€ì•Šë‹¤.
 ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ë§ì€ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ ì²˜ë¦¬í• ê²ƒì´ê³  ì–‘ì´ ë°©ëŒ€í•´ì§ˆê²ƒì´ê¸° ë•Œë¬¸
 ë”°ë¼ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ í´ë”/íŒŒì¼ì„ ë”°ë¡œ ë§Œë“¤ì–´ ê´€ë¦¬í•˜ì.

export
 -> default exportí•œê²ƒì„ importí• ë•Œ ì§€ì •í•˜ëŠ” ì´ë¦„ì€ ê°™ì§€ì•Šì•„ë„ ë€ë‹¤
 í•˜ì§€ë§Œ ê°œë³„ì„ exportí• ë•ŒëŠ” ë°˜ë“œì‹œ ì„œë¡œ ê°™ì•„ì•¼ í•œë‹¤.
 ->ì¤‘ê´„í˜¸ ì—´ê³  { edit, remove, ...}ë“± ë¶ˆëŸ¬ì˜¬ê²ƒì„ ë˜‘ê°™ì´ ì ì–´ë„£ì–´ ì˜¤ë¸Œì íŠ¸í™”ì‹œí‚¨ë‹¤.
 ** ê²½ë¡œì§€ì • ê·œì¹™
 ../ ì§€ê¸ˆìˆëŠ” í´ë”ì—ì„œ ë²—ì–´ë‚¨
 ./ ì§€ê¸ˆìˆëŠ” ì¥ì†Œ

 #4.7
 URL parameters
 videoRouter.get("/:id", see);
 /:idì—ì„œ :ì€ ë’¤ì—ì˜¤ëŠ” idê°€ íŒŒë¼ë©”í„°(ë³€ìˆ˜)ë¼ê³  expressì—ê²Œ ì•Œë ¤ì¤€ë‹¤.
 ê·¸ íŒŒë¼ë©”í„°ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ req.params.idë¡œ ìœ ì €ì˜ ë¦¬í€˜ìŠ¤íŠ¸ì¤‘ íŒŒë¼ë©”í„°ê°’ì´ ë¬´ì—‡ì¸ì§€ í™•ì¸ê°€ëŠ¥.

 **ë¹„ë””ì˜¤ ë¼ìš°í„°ì—ì„œ
  videoRouter.get("/upload", upload);
  videoRouter.get("/:id", see);
  videoRouter.get("/:id/edit", edit);
  ì²˜ëŸ¼ uploadë¥¼ ë§¨ìœ„ë¡œ ì˜¬ë¦¬ëŠ” ì´ìœ ê°€ ìˆë‹¤.
  expressëŠ” ìœ„ì—ì„œë¶€í„° ì•„ë˜ë¡œ ì²´í¬í•˜ê¸°ë•Œë¬¸ì—, ë§Œì•½ 
  videoRouter.get("/:id", see);
  videoRouter.get("/upload", upload);
  videoRouter.get("/:id/edit", edit);
  ì´ìˆœì„œì´ê³ , ìœ ì €ê°€ videos/uploadë¡œ requestë¥¼ ë³´ë‚´ë©´
  expressëŠ” :idë¥¼ ë¨¼ì €ë³´ê³  /uploadë¥¼ íŒŒë¼ë©”í„°ë¡œ ì·¨ê¸‰í•˜ê²Œë€ë‹¤.
  =>ì´ê²ƒì˜ í•´ê²°ì„ìœ„í•´ express ì •ê·œì‹ì„ ì‚¬ìš©í•œë‹¤.
  ì •ê·œì‹ì„ ì‚¬ìš©í•˜ì—¬ íŒŒë¼ë©”í„°ì— ìˆ«ìë§Œ ì˜¬ìˆ˜ìˆê²Œ í•˜ëŠ”ê²ƒì´ë‹¤.

#4.8
URL parameters ì •ê·œì‹
  Routing
  https://expressjs.com/ko/guide/routing.html
  ì •ê·œí‘œí˜„ì‹ í…ŒìŠ¤íŠ¸ ì‚¬ì´íŠ¸
  https://www.regexpal.com
  ì •ê·œì‹ í‘œí˜„ ì •ë¦¬ê¸€
  https://kasterra.github.io/regex1-the-basic-operation/

  \w+: ëª¨ë“  ë¬¸ì, ìˆ«ì ì„ íƒ
  \d+: ëª¨ë“  ìˆ«ì ì„ íƒ

#5.1

**
pugì‚¬ìš©ì—ëŒ€í•œ ì˜ë¬¸
res.sendFile(__dirname, 'potato.html') ê°™ì´ html íŒŒì¼ì„ ë°”ë¡œ ë Œë”ë§ í•  ìˆ˜ ìˆê¸´ í•©ë‹ˆë‹¤.
í•˜ì§€ë§Œ requestë¥¼ í†µí•´ ê°ì¢… ë³€ìˆ˜ë¥¼ ì „ë‹¬í•˜ì§€ ëª»í•˜ê¸° ë•Œë¬¸ì— ë¯¸ë¦¬ ì •í•´ë‘” í™”ë©´ ë°–ì—ëŠ” ë³´ì—¬ì¤„ ìˆ˜ê°€ ì—†ê³ ,
header ë‚˜ footer ë“±ì„ ë”°ë¡œ partialë¡œ ë§Œë“¤ì–´ ê´€ë¦¬í•˜ê³  ëª¨ë“  íŒŒì¼ì— ì²¨ë¶€í•œë‹¤ë“ ì§€ í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— pugë¥¼ ì“°ëŠ” ê²ƒì…ë‹ˆë‹¤.
ë˜í•œ pugì™¸ì—ë„ ejsë“± ë‹¤ë¥¸ template engineë„ ìˆìŠµë‹ˆë‹¤. ì €ëŠ” ì¨ ë³¸ ê²ƒ ì¤‘ì—ì„œëŠ” pugê°€ ì œì¼ ê¹”ë”í•˜ê³  ì¢‹ì€ ê²ƒ ê°™ë„¤ìš”.
ê·¸ë¦¬ê³  ì•„ì˜ˆ reactë“±ì˜ frameworkë¥¼ ì‚¬ìš©í•˜ì‹œë©´ í…œí”Œë¦¿ ì—”ì§„ ì—†ì´ viewë¶€ë¶„ì„ ë§Œë“œì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

pugì‚¬ìš©
sendì— htmlì„ ë³´ë‚´ê¸°ëŠ” í˜ë“¤ë‹¤.
pugë¥¼ ì‚¬ìš©í•˜ë©´ í¸í•˜ë‹¤.
 1) ê¹”ë”í•œ htmlì‘ì„±ì„ ë„ì™€ì¤€ë‹¤(ë‹«ì§€ì•Šì•„ë„ë€ë‹¤)
 2) htmlì— ìë°”ìŠ¤í´ë¹„íŠ¸ ì½”ë“œë¥¼ í¬í•¨ì‹œí‚¬ìˆ˜ìˆë‹¤.
 3) ë°˜ë³µì´ ìˆìœ¼ë©´ partialsí´ë”ë¥¼ ë§Œë“¤ì–´ ê·¸ê³³ì— ë°˜ë³µíŒŒì¼ì„ ë§Œë“¤ê³ 
 htmlë‚´ì—ì„œ include ì‹œí‚¤ë©´ë€ë‹¤
ë”°ë¼ì„œ ê·¸ê±¸ ë„ì™€ì£¼ëŠ” pugë¥¼ ì„¤ì¹˜í•œë‹¤ npm i pug
->server.jsì—ì„œ app.set("view engine", "pug")ì„ í†µí•´
viewì—”ì§„ì´ pugë¼ëŠ”ê±¸ expressì— ì•Œë ¤ì¤€ë‹¤.
**
í—¤ë”ì—ì„œ Expressë¥¼ ì—†ì• ëŠ” ë°©ë²•:
app.disable('x-powered-by');
->viewsí´ë”ì— pugíŒŒì¼ì„ ë§Œë“ ë‹¤.

**
ë””í´íŠ¸ë¡œ expressëŠ” cwd + /viewsì—ì„œ pug íŒŒì¼ì„ ì°¾ëŠ”ë‹¤.
cwd(current working directory)ëŠ” node.jsë¥¼ ì‹¤í–‰í•˜ëŠ” pacakge.jsonì´ ìˆëŠ” ë””ë ‰í† ë¦¬ì´ë¯€ë¡œ
í˜„ì¬ í”„ë¡œì íŠ¸ëŠ”wetube/ê°€ cwdì´ë‹¤.
í˜„ í”„ë¡œì íŠ¸ì— viewsí´ë”ëŠ” wetube/src/ì•ˆì— ìˆê¸°ë•Œë¬¸ì— ë””í´íŠ¸ viewê²½ë¡œë¥¼ ë°”ê¾¼ë‹¤.
app.set("views", process.cwd() + "/src/views")ìœ¼ë¡œ ê²½ë¡œë¥¼ ë°”ê¿€ìˆ˜ìˆë‹¤.

#5.3
blockê¸°ëŠ¥
 ìƒì†ì„ í•´ì¤„ base.pugíŒŒì¼ì—ì„œ blockì„ ë§Œë“¤ì–´ë†“ìœ¼ë©´
 ìƒì†ë°›ëŠ” íŒŒì¼ì—ì„œ blockì•ˆ ë‚´ìš©ì„ ì±„ìš¸ìˆ˜ ìˆë‹¤.
includeê¸°ëŠ¥
 base.pugíŒŒì¼ì—ì„œ includeë¡œ ë‚´ìš©ì„ì¶”ê°€í•´ë†“ìœ¼ë©´ ëª¨ë“  ìƒì†ë°›ëŠ” íŒŒì¼ì—ì„œ
 ê·¸ ë‚´ìš©ì´ ì ìš©ë€ë‹¤.
PugëŠ” í…œí”Œë¦¿ ìƒì†ì„ ì§€ì›í•©ë‹ˆë‹¤. í…œí”Œë¦¿ ìƒì†ì€ blockê³¼ extendsí‚¤ì›Œë“œë¥¼ í†µí•´ ì‚¬ìš©í•©ë‹ˆë‹¤.
í…œí”Œë¦¿ì˜ blockì—ëŠ” í•˜ìœ„ í…œí”Œë¦¿ì„ ëŒ€ì²´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
**
ENOENT: no such file or directory, open '/home/ndm02002/wetube/src/views/base.pug'
base íŒŒì¼ì„ view ì•„ë˜ì— ë†“ì•„ì•¼ ë¨ ã… 

#5.4
ë³€ìˆ˜variables ì‚¬ìš©
ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë³€ìˆ˜ë¥¼ ê°™ì´ ë³´ë‚´ë©´, ê·¸ ë³€ìˆ˜ë¥¼ pugì—ì„œë„ ì‚¬ìš©í• ìˆ˜ìˆë‹¤.
ì»¨íŠ¸ë¡¤ëŸ¬ => res.render("home", { pageTitle: "Home" });
base.pug => title #{pageTitle} | Wetube

#5.5
pug recap
1) íŒŒì´ì¬ì²˜ëŸ¼ ê¹”ë”í•œ ì½”ë“œë¥¼ ì“¸ìˆ˜ìˆë‹¤.
  íƒœê·¸ë¥¼ ë‹«ëŠ”ê²ƒ x
  ëª¨ë‘ íƒ­ê³¼ ë„ì–´ì“°ê¸°ë¡œ êµ¬ë¶„ë€ë‹¤.
2) expressê°€ ëœë”ë§ í• ìˆ˜ìˆë‹¤.
  app.setìœ¼ë¡œ ì–´ë””ì„œì°¾ëŠ”ì§€ ì„¤ì •í•´ì¤€ë’¤
  res.render("pugíŒŒì¼ëª…)
3) include : ìƒì†ë°›ëŠ” ëª¨ë“ íŒŒì¼ì—ì„œ ê³µí†µì ìœ¼ë¡œ ë‚˜íƒ€ë‚¼ë•Œ

4) base.pug ê¸°ë³¸êµ¬ì¡°ë¥¼ ë§Œë“¤ì–´ ë‹¤ë¥¸íŒŒì¼ì—ì„œ ë˜‘ê°™ì´ ìƒì†ë°›ì„ë•Œ
blockê¸°ëŠ¥ìœ¼ë¡œ ìƒì†ë°›ëŠ” íŒŒì¼ë“¤ì´ ë¸”ë¡ ë‚´ìš©ì„ ì±„ì›Œë„£ì„ìˆ˜ìˆë‹¤.

5) variable
ìë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œë¥¼ #{}ë¡œ ì“¸ìˆ˜ìˆë‹¤.
ì´ë•Œ ë³€ìˆ˜ë„ ì“¸ìˆ˜ìˆëŠ”ë°, ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ëœë”ë§í• ë•Œ ë³€ìˆ˜ë¥¼ ê°™ì´ ë³´ë‚´ì£¼ë©´
ê·¸ ë³€ìˆ˜ë¥¼ pugíŒŒì¼ì—ì„œ ì‚¬ìš©ê°€ëŠ¥í•˜ë‹¤.

#5.6
MVP Styles
ëª¨ë“  html elementë¥¼ ì´ì˜ê²Œ ë§Œë“¤ì–´ì£¼ëŠ”
link(rel="stylesheet" href="https://unpkg.com/mvp.css")ë¥¼ í—¤ë“œì— ì¶”ê°€

#5.7
pugì—ì„œ ë³€ìˆ˜ë¥¼ ëŒ€ì…í• ë•Œ 2ê°€ì§€ë°©ë²•
title #{pageTitle} Wetube
title = pageTitle =>í•œê°œì˜ ë³€ìˆ˜ì™¸ì— í…ìŠ¤íŠ¸ê°€ì—†ì„ë•Œ.

pugì—ì„œë„ ì¡°ê±´ë¬¸ì„ ì“¸ìˆ˜ìˆë‹¤ if/else
if ì¡°ê±´
  ì‹¤í–‰ì‹
else
  ì‹¤í–‰ì‹

#5.8
Iteration
  elementsì˜ listë¥¼ ë³´ì—¬ì£¼ëŠ”ê²ƒ
Iteration (ë°˜ë³µ)

PugëŠ” eachì™€ whileë¼ëŠ” ë‘ ê°€ì§€ ê¸°ë³¸ ë°˜ë³µ ë°©ë²•ì„ ì§€ì›í•©ë‹ˆë‹¤.
```
ul
each val(ì•„ë¬´ì´ë¦„ê°€ëŠ¥) in [1, 2, 3, 4, 5](ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë³´ë‚´ì¤€ ë³€ìˆ˜ëª…ì´ë‘ ê°™ì•„ì•¼)
li= val
```

**
ë°°ì—´ì´ë‚˜ ê°ì²´ì— ë°˜ë³µí•  ê°’ì´ ì—†ìœ¼ë©´ ì‹¤í–‰ë  else ë¸”ë¡ì„ ì¶”ê°€í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
```
- var values = [];
ul
each val in values
li= val
else
li There are no values
```
https://pugjs.org/language/iteration.html

#5.9
mixin
=> partialê³¼ ìœ ì‚¬í•œ ë°ì´í„°ë¥¼ ë°›ì„ìˆ˜ìˆëŠ” ë¯¸ë¦¬ ë§Œë“¤ì–´ì§„ HTML blockì´ë‹¤.
ì‚¬ìš©
1)mixinsí´ë”ì— mixiníŒŒì¼ëª….pugë¥¼ ë§Œë“¤ì–´ì£¼ê³  ë‚´ìš©ì„ ì‘ì„±í•œë‹¤.
2)mixinì´ í•„ìš”í•œ ê³³ì—ì„œ include mixins/video(íŒŒì¼ëª…)ìœ¼ë¡œ ì¸í´ë£¨ë“œ í•´ì¤€ë‹¤.
3)ì‚¬ìš©ì´ í•„ìš”í•œ ìœ„ì¹˜ì—ì„œ +íŒŒì¼ëª…(ë³€ìˆ˜ëª…) ë„£ì–´ì¤€ë‹¤
    each potato in videos
        +video(potato)
    else
        li Sorry nothing found.
ìì„¸íˆëŠ”
https://pugjs.org/language/mixins.html

#5.10
Iteration mixin recap
Iterationì€ arrayì˜ ëª¨ë“  elementì— ëŒ€í•´ íŠ¹ì • í–‰ë™ì„ í• ë•Œ ì”€
mixinì€ partialê³¼ ìœ ì‚¬í•˜ê²Œ ë°˜ë³µí•´ì„œ ì“°ì§€ë§Œ
ë°ì´í„°ë„ ë°›ì•„ ì“¸ìˆ˜ìˆëŠ”ê²ƒì´ ë‹¤ë¥´ë‹¤.

#6.0
POST

pugì—ì„œ ë³€ìˆ˜variableì„ ì“°ëŠ”ë°©ë²•ì€ =, #{} ë‘ê°œê°€ ìˆë‹¤ê³ 
ìœ„ì—ì„œ ë°°ì› ì§€ë§Œ attributeì—ëŠ” ì“¸ìˆ˜ì—†ë‹¤.
attributeì—ì„œ ë³€ìˆ˜ë¥¼ ì“°ëŠ”ë°©ë²•ì€ `${}` í˜¹ì€ + video.id ë¡œ ë‘ê°€ì§€ì´ë‹¤.

**ES6
const { id } = req.params;
const id = req.params.id;

#6.1

absoulte(/) relative URL ì ˆëŒ€ ìƒëŒ€
í˜„ì¬ ê²½ë¡œê°€ localhost:4000/video/editì¸ë°
a(href="/potato")ì´ë©´ =>localhost:4000/potatoë¡œ(absoulte)
a(href="potato")ì´ë©´ =>localhost:4000/video/potatoë¡œ(relative)

#6.2
POST
form(action="")ì˜ actionì—ëŠ” submitì„ ëˆ„ë¥´ë©´ ë°ì´í„°ê°€ ê°€ê²Œë ê³³ì„ ì ëŠ”ë‹¤.
ë””í´íŠ¸ ì „ì†¡ë°©ì‹ì€ getì´ë‹¤(method="GET") POSTë¡œ ë°”ê¿”ì£¼ë©´ POSTì „ì†¡ì´ë€ë‹¤.
POSTë¥¼ ì“°ë ¤ë©´ ë¼ìš°í„°ì—ì„œë„ POSTë¡œ ë°›ì•„ì¤˜ì•¼í•œë‹¤.

methodëŠ” formê³¼ back end ì‚¬ì´ì˜ ì •ë³´ ì „ì†¡ ë°©ì‹ì´ë‹¤.
ì „ì†¡í•˜ëŠ” ë°ì´í„°ë¡œ backendì—ì„œ databaseì˜ ì •ë³´ë¥¼ ìˆ˜ì •,ì¶”ê°€,ì‚­ì œ..ë“±ì„ í• ê±°ë©´
POSTë¡œ ì „ì†¡í•´ì•¼í•œë‹¤.

#6.3
get - ì ‘ê·¼
post - ì „ì†¡
redirect - ë‹¤ì‹œë³´ë‚´ë‹¤
parameter - ë§¤ê°œë³€ìˆ˜
expressëŠ” formìœ¼ë¡œ ë³´ë‚¸ ë°ì´í„°ë¥¼ ì½ì§€ëª»í•¨

**
req.body
req.bodyì—ëŠ” formì„ í†µí•´ submitëœ ë°ì´í„°ì˜ í‚¤-ê°’ ìŒì„ í¬í•¨í•©ë‹ˆë‹¤.
ê¸°ë³¸ì ìœ¼ë¡œëŠ” undefinedì´ë©° express.json() ë˜ëŠ” express.urlencoded()ì™€ ê°™ì€ ë°”ë”” íŒŒì‹± ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•  ë•Œ ê°’ì„ ë°›ì•„ì˜µë‹ˆë‹¤.

```
// ì• í”Œë¦¬ì¼€ì´ì…˜/json íŒŒì‹±
app.use(express.json());
// application/x-www-form-urlencodedíŒŒì‹± (formë°ì´í„° íŒŒì‹±)
app.use(express.urlencoded({ extended: true }));
```
https://expressjs.com/ko/api.html#req.body

express.urlencoded([options])
Expressì— ë‚´ì¥ëœ ë¯¸ë“¤ì›¨ì–´ ê¸°ëŠ¥ì…ë‹ˆë‹¤. urlencoded í˜ì´ë¡œë“œë¡œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ êµ¬ë¬¸ ë¶„ì„í•˜ê³  ë°”ë”” íŒŒì„œë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•©ë‹ˆë‹¤.
https://expressjs.com/ko/api.html#express.urlencoded


POSTë¡œ ë³´ë‚¸ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ req.bodyë¡œ ì‚¬ìš©ê°€ëŠ¥í•˜ë‹¤.
í•˜ì§€ë§Œ expressëŠ” ì•„ì§ ì´ê±¸ ì´í•´ëª»í•œë‹¤.
express appì´ formì˜ valueë¥¼ ì´í•´í•˜ë ¤ë©´ ì„¸íŒ…ì´í•„ìš”í•˜ë‹¤.
server.jsì— ë‹¤ìŒì„ ì¶”ê°€í•œë‹¤.
app.use(express.urlencoded({ extended: true }));
 => ë¼ìš°í„°ë¥¼ ì‚¬ìš©í•˜ê¸°ì „ì— ì ìš©ì´ ë¼ì•¼í•œë‹¤.

#6.4
POST recap
ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì“°ëŠ” req.paramsëŠ”
 ë¼ìš°í„°ì—ì„œ ë³´ë‚¸ /:id(//d+)ë¥¼ ê°€ë¦¬í‚¨ë‹¤.
req.bodyëŠ” pugì—ì„œ ë³´ë‚¸ formì—ìˆëŠ” valueì˜ JavaScript representationì´ë‹¤.
 => ì´ê±¸ ì´ìš©í•˜ê¸°ìœ„í•´ server.jsì— ì„¤ì •ì„ í•´ì¤˜ì•¼í•œë‹¤.
 => formì•ˆì˜ inputì— nameì„ ì„¤ì •í•´ì¤˜ì•¼ req.bodyì•ˆì˜ ë°ì´í„°ë¥¼ ì“¸ìˆ˜ìˆë‹¤.
**
GETìœ¼ë¡œë³´ë‚¸ ë°ì´í„°ëŠ” req.query.inputNameìœ¼ë¡œ ì‚¬ìš©í• ìˆ˜ìˆë‹¤!

#6.8
mongoose
  ìë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œë¡œ mongodbë¥¼ ì“¸ìˆ˜ìˆê²Œ í•´ì¤€ë‹¤
  1)npm i mongooseë¡œ ì„¤ì¹˜
  2)db.jsíŒŒì¼ì—ì„œ import mongoose from "mongoose"
  3)mongoose.connect("mongodb://127.0.0.1:27017/dbëª…");
    =>urlì£¼ì†ŒëŠ” cmdì—ì„œ mongo ì»¤ë§¨ë“œ ì‹¤í–‰ì‹œ ë‚˜ì˜¤ëŠ” ì£¼ì†Œ
ê·¸ì™¸ì„¤ì •
  const db = mongoose.connection;

  const handleOpen = () => console.log("âœ… Connected to DB");
  const handleError = (error) => console.log("âŒ DB Error", error);

  db.on("error", handleError);
  db.once("open", handleOpen);
  on => ì´ë²¤íŠ¸ë°œìƒì‹œ ëª‡ë²ˆì´ê³  ë°˜ë³µí•¨
  once => ì´ë²¤íŠ¸ë°œìƒì‹œ í•œë²ˆë§Œì‹¤í–‰í•¨

#6.9
Video model
 ëª¨ë¸ ì´ë¦„ì€ ëŒ€ë¬¸ìë¡œ ì‹œì‘í•œë‹¤. Video.js ì´ê²Œ ê´€ìŠµì´ë‹¤.

ìŠ¤í‚¤ë§ˆ:ë¬¼ë¦¬ì ì¸ ì¥ì¹˜ë¡œë¶€í„° ë…¼ë¦¬ì ì¸ ë°ì´í„° ë² ì´ìŠ¤ ë ˆì½”ë“œ(data base record)ë¥¼
ë§¤í•‘(mapping)í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ì •ì˜ ì •ë³´ë¥¼ ë§í•œë‹¤.

#6.11

Video.find( {}, callback?: )
{} => search terms, ì´ê²Œ ë¹„ì–´ìˆìœ¼ë©´ ëª¨ë“  ë¹„ë””ì˜¤ë¥¼ ì°¾ê²Œëœë‹¤.

#6.12
databaseê°€ javascript ë°–ì—ì„œ ìˆ˜í–‰ë˜ë‹¤ë³´ë‹ˆ(jsì™€ ë¹„ë™ê¸°ì´ë‹¤)
find({}, ...)ê°€ ë‹¤ë¥¸(console.logê°™ì€..)ê²ƒ ë³´ë‹¤ ëŠ¦ê²Œ ìˆ˜í–‰ëœë‹¤.

database ê²€ìƒ‰ì´ ì•ˆëë‚¬ì„ë•Œ renderí•˜ëŠ”ê²ƒì„ ë°©ì§€í•˜ëŠ”ë²•
1.
Video.find({}, (error, videos) => {
    
    return res.render("home", { pageTitle: "Home", videos });
  });
Video.find()ì˜ ì½œë°±í•¨ìˆ˜((error, videos) =>) ì•ˆì— renderë¥¼ ë„£ëŠ”ë‹¤.

ë‹¨ì  : functionì•ˆì— functionì„ ë„£ì–´ì„œ ê¹”ë”í•˜ì§€ì•Šì•„

#6.13

database ê²€ìƒ‰ì´ ì•ˆëë‚¬ì„ë•Œ renderí•˜ëŠ”ê²ƒì„ ë°©ì§€í•˜ëŠ”ë²•

2. promise => callbackì˜ ìµœì‹ ë²„ì „
async(ë¹„ë™ê¸°) -- await(ìˆ˜í–‰ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì¤€ë‹¤)
=> ë°ì´í„°ë² ì´ìŠ¤ê°€ ë°ì´í„° ì°¾ì„ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì¤€ë‹¤(ë‹¤ìŒ ê²ƒì´ ë¨¼ì € ìˆ˜í–‰ë˜ëŠ” ê²ƒì„ ë§‰ìŒ)
ì—ëŸ¬ëŠ” try-catchë¬¸ìœ¼ë¡œ ì¡ëŠ”ë‹¤.

async function
async function ì„ ì–¸ì€ AsyncFunctionê°ì²´ë¥¼ ë°˜í™˜í•˜ëŠ” í•˜ë‚˜ì˜ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
ë¹„ë™ê¸° í•¨ìˆ˜ëŠ” ì´ë²¤íŠ¸ ë£¨í”„ë¥¼ í†µí•´ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‘ë™í•˜ëŠ” í•¨ìˆ˜ë¡œ, ì•”ì‹œì ìœ¼ë¡œ Promiseë¥¼ ì‚¬ìš©í•˜ì—¬ ê²°ê³¼ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
ê·¸ëŸ¬ë‚˜ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ì½”ë“œì˜ êµ¬ë¬¸ê³¼ êµ¬ì¡°ëŠ”, í‘œì¤€ ë™ê¸° í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ”ê²ƒê³¼ ë§ì´ ë¹„ìŠ·í•©ë‹ˆë‹¤.
https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Statements/async_function

export const home = async (req, res) => {
  const videos = await Video.find({});
  return res.render("home", { pageTitle: "Home", videos });
};
async functionì„ ì–¸ìœ¼ë¡œ ë¹„ë™ê¸°í•¨ìˆ˜ë¥¼ ì„ ì–¸í•˜ê³ 
awaitë¥¼ ì¨ì„œ dbì—ì„œ ë°ì´í„°ë¥¼ ì°¾ì„ë•Œê¹Œì§€ ê¸°ë‹¤ë¦°ë‹¤.

ì¥ì : ì§ê´€ì ìœ¼ë¡œ ì½”ë“œë¥¼ ë³´ê¸° í¸í•˜ë‹¤.

#6.14
1. returnì˜ ì—­í•  : ë³¸ì§ˆì ì¸ returnì˜ ì—­í• ë³´ë‹¤ëŠ” functionì„ ë§ˆë¬´ë¦¬ì§“ëŠ” ì—­í• ë¡œ ì‚¬ìš©ë˜ê³  ìˆìŒ.
- ì´ëŸ¬í•œ ê²½ìš° returnì´ ì—†ì–´ë„ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ì§€ë§Œ ì‹¤ìˆ˜ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ returnì„ ì‚¬ìš©
2. renderí•œ ê²ƒì€ ë‹¤ì‹œ renderí•  ìˆ˜ ì—†ìŒ
- redirect(), sendStatus(), end() ë“±ë“± í¬í•¨ (expressì—ì„œ ì˜¤ë¥˜ ë°œìƒ)

#6.15
hashtags: hashtags.split(",").map((word) => `#${word}`)
split(",") => ë°ì´í„°ë“¤ì„ ,ë¡œ ì˜ë¼ì„œ ë°°ì—´ë¡œ ëŒë ¤ì¤€ë‹¤.
map((word) => `#${word}`) =>ë°°ì—´ì•ˆì˜ ë°ì´í„°ë“¤ì—ê²Œ #ë¥¼ë¶™ì¸ë‹¤.

console.log(video)ë¥¼ í•˜ë©´ ìš°ë¦¬ê°€ ë§Œë“¤ì§€ì•Šì€ idê°€ ìˆëŠ”ë°
create videoë¥¼ í• ë•Œ mongooseê°€ idë¥¼ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì¤€ë‹¤.

#6.16

dbì— ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ë‘ê°€ì§€ë°©ë²•
1.ëª¨ë¸ëª….create()ì‚¬ìš©
2.save()ì‚¬ìš©


MongoDBì˜ collectionì´ë¦„ì´ Videoê°€ ì•„ë‹Œ videosì¸ ì´ìœ 
MongooseëŠ” ìë™ìœ¼ë¡œ ëª¨ë¸ì„ ì°¾ê³ , í•´ë‹¹ ëª¨ë¸ì˜ ì´ë¦„ì„ ë”°ì„œ ì†Œë¬¸ì+ë’¤ì— s(ë³µìˆ˜í˜•)ì„ ë¶™ì—¬ ì»¬ë ‰ì…˜ì„ ìƒì„±í•©ë‹ˆë‹¤.
Tank ëª¨ë¸ì€ -> ì»¬ë ‰ì…˜ì— ì €ì¥ë  ë•Œ, tanksë¡œ ì €ì¥ë©ë‹ˆë‹¤.

Document.prototype.save()
https://mongoosejs.com/docs/api.html#document_Document-save

Model.create()
í•˜ë‚˜ ì´ìƒì˜ ë¬¸ì„œë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ê¸° ìœ„í•œ ì†ì‰¬ìš´ ë°©ë²•ì…ë‹ˆë‹¤.
MyModel.create(docs)ëŠ” ë¬¸ì„œì˜ ëª¨ë“  ë¬¸ì„œì— ëŒ€í•´ ìƒˆë¡œìš´ MyModel(doc).save()ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.
create()ì„ í•˜ê²Œ ë˜ë©´ save()ë¥¼ ìƒëµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
create()ì´ ë‹¤ìŒ ë¯¸ë“¤ì›¨ì–´ì¸ save()ë¥¼ íŠ¸ë¦¬ê±°í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
https://mongoosejs.com/docs/api.html#model_Model.create

Collection: Documentë“¤ì„ ë‹´ê³  ìˆëŠ” ë¬¶ìŒ

#6.17
Exception & validation
1. try/catchë¥¼ í†µí•œ ì—ëŸ¬ì²˜ë¦¬, ì—ëŸ¬ë©”ì„¸ì§€ ì „ë‹¬
2. Schema parameter : default
3. Schema CreatedAtì— Date.now()ê°€ ì•„ë‹Œ Date.nowë¥¼ ì ëŠ” ì´ìœ  : ìƒì„±ë ë•Œë§Œ ì‹¤í–‰ë˜ë„ë¡
 =>videoSchema ì—ì„œ default: Date.now() ë¼ê³  í•˜ë©´ ê·¸ schemaê°€ ìˆëŠ” íŒŒì¼ì„ ì €ì¥í•˜ëŠ” ì‹œê°„ì´ default ë¡œ ì €ì¥ëŒ

#6.18
More Schema (ëª½êµ¬ìŠ¤ ìŠ¤í‚¤ë§ˆ)
ëª½êµ¬ìŠ¤ ìŠ¤í‚¤ë§ˆ íƒ€ì… í™•ì¸
Mongoose ìŠ¤í‚¤ë§ˆëŠ” Mongoose ëª¨ë¸ì„ êµ¬ì„±í•˜ê¸° ìœ„í•œ ê°ì²´ë¡œ ìƒê°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
https://mongoosejs.com/docs/schematypes.html

ëª½êµ¬ìŠ¤ ìŠ¤í‚¤ë§ˆ íƒ€ì… ì •ì˜
ëª½êµ¬ìŠ¤ì˜ ëª¨ë“  ê²ƒì€ ìŠ¤í‚¤ë§ˆë¡œ ì‹œì‘í•©ë‹ˆë‹¤. ê° ìŠ¤í‚¤ë§ˆëŠ” MongoDB ì»¬ë ‰ì…˜ì— ë§¤í•‘ë˜ê³  í•´ë‹¹ ì»¬ë ‰ì…˜ ë‚´ ë¬¸ì„œì˜ ëª¨ì–‘ì„ ì •ì˜í•©ë‹ˆë‹¤.
https://mongoosejs.com/docs/guide.html

#6.19
ì •ê·œì‹ regular expression
1. mongooseê°€ ë¶€ì—¬í•œ idë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ idì— ìˆ«ìë§Œ ì‚¬ìš©ê°€ëŠ¥í•˜ê²Œ ì„¤ì •í•œ Routerë¶€ë¶„ ë³€ê²½
- http://regexpal.com ì„ í†µí•œ ì •ê·œì‹ ìƒì„±í•˜ê¸°
2. idë¥¼ í†µí•´ db ë‚´ ìƒ‰ì¸, í•´ë‹¹ ë°ì´í„° ì‚¬ìš©í•˜ê¸°

#6.20
Edit Video
1. .exec()ì— ëŒ€í•œ ê°„ëµí•œ ì„¤ëª…
2. ì‚¬ìš©ìê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” IDì— ì ‘ê·¼í•  ê²½ìš° => if {404.pug}
3. ì¼ë°˜ì ìœ¼ë¡œ ì—ëŸ¬ë¥¼ ifì— ì²˜ë¦¬, returnìœ¼ë¡œ í•¨ìˆ˜ ì¢…ë£Œ
4. join()ìœ¼ë¡œ ë°°ì—´ì„ ë¬¸ìì—´ë¡œ í†µí•©

#6.21
1. post ë³µìŠµ
2. postEdit êµ¬í˜„, ì¼ì¼íˆ ìˆ˜ì • => ì•ˆ ì¦ê²ë‹¤
3. startWith()ë¡œ # ìœ ë¬´ í™•ì¸
4. ì¡°ê±´ë¶€ ì—°ì‚°ì ?ë¥¼ í†µí•œ ê°„ê²°í•œ ì¡°ê±´ë¬¸

String.prototype.startsWith()
startsWith() ë©”ì†Œë“œëŠ” ì–´ë–¤ ë¬¸ìì—´ì´ íŠ¹ì • ë¬¸ìë¡œ ì‹œì‘í•˜ëŠ”ì§€ í™•ì¸í•˜ì—¬
ê²°ê³¼ë¥¼ true í˜¹ì€ falseë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.
https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/String/startsWith

String.prototype.endsWith()
The endsWith() ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì–´ë–¤ ë¬¸ìì—´ì—ì„œ íŠ¹ì • ë¬¸ìì—´ë¡œ ëë‚˜ëŠ”ì§€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©°,
ê·¸ ê²°ê³¼ë¥¼ true í˜¹ì€ falseë¡œ ë°˜í™˜í•œë‹¤.
https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/String/endsWith

#6.22
Edit part three
1. Model.findByIdAndUpdate()ë¡œ ë¶ˆëŸ¬ì˜¤ê¸°ì™€ ìˆ˜ì • í•œë°©ì— => ì¦ê²ë‹¤
2. Model.exist() =>true false ë°˜í™˜
3. ìƒì„±ì´ë‚˜ ì—…ë°ì´íŠ¸ ì „ ì‘ë™í•´ì•¼í•  functionì˜ í•„ìš”ì„± => Mongooseì˜ Middleware í™œìš©

#6.23
1. DeprecationWarningì— ëŒ€í•´.. useFindAndModify: falseë¡œ ì„¤ì •í•˜ë©´ í•´ê²°ë¨
2. middlewareëŠ” ë¬´ì¡°ê±´ modelì´ ìƒì„±ë˜ê¸° ì „ì— ë§Œë“¤ì–´ì•¼ í•œë‹¤
3. mongooseì˜ middlewareì—ì„œ thisí‚¤ì›Œë“œëŠ” ì €ì¥í•˜ê³ ì í•˜ëŠ” ë¬¸ì„œë¥¼ ê°€ë¦¬í‚´
4. middlewareì—ì„œ í•´ì‹œíƒœê·¸ ê´€ë¦¬ êµ¬í˜„

cmd ì»¤ë§¨ë“œ
1. ëª½ê³  ì‚¬ìš©í•˜ê¸°
> mongo

2. ë‚´ê°€ ê°€ì§„ db ë³´ê¸°
> show dbs

3. í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ db í™•ì¸
> db

4. ì‚¬ìš©í•  db ì„ íƒí•˜ê¸°
> use dbName
(í˜„ì¬ ìˆ˜ì—…ì—ì„œëŠ” `use wetube`)

5. db ì»¬ë ‰ì…˜ ë³´ê¸°
> show collections

6. db ì»¬ë ‰ì…˜ ì•ˆì— documents ë³´ê¸°
> db.collectionName.find()
(í˜„ì¬ ìˆ˜ì—…ì—ì„œëŠ” `db.videos.find()`)

7. db ì»¬ë ‰ì…˜ ì•ˆì— documents ë‚´ìš© ëª¨ë‘ ì œê±°í•˜ê¸°
> db.collectionName.remove({})
(í˜„ì¬ ìˆ˜ì—…ì—ì„œëŠ” `db.videos.remove({})`)

#6.24
Static function(ìŠ¤íƒœí‹± í•¨ìˆ˜)
1. findByIdAndUpdate()ì—ì„œëŠ” save í›…ì—…ì´ ë°œìƒí•˜ì§€ ì•ŠìŒ => ë‹¤ë¥¸ ë°©ë²•ì„ ì•Œì•„ë³´ì
2. Video.jsì— functionì„ ë§Œë“¤ì–´ì„œ epxortí•´ì„œ ê´€ë¦¬í•˜ê¸° => ì´ê²ƒë„ ê´œì°®ìŒ ê·¼ë° ë‹¤ë¥¸ê²ƒë„ ì•Œì•„ë³´ì
3. staticì„ ì‚¬ìš©í•˜ë©´ import ì—†ì´ë„ Model.function()í˜•íƒœë¡œ ì‚¬ìš©ì´ ê°€ëŠ¥í•¨ => super cool

Statics
ëª¨ë¸ì— static í•¨ìˆ˜ë¥¼ ì¶”ê°€í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
ìŠ¤í‚¤ë§ˆì—ì„œ ì»´íŒŒì¼ëœ ëª¨ë¸ì— ì •ì  "class" ë©”ì„œë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

Static ì‚¬ìš©í•˜ëŠ” ë‘ ê°€ì§€ ë°©ë²•
```
// Assign a function to the "statics" object of our animalSchema
animalSchema.statics.findByName = function(name) {
return this.find({ name: new RegExp(name, 'i') });
};
// Or, equivalently, you can call `animalSchema.static()`.
animalSchema.static('findByBreed', function(breed) { return this.find({ breed }); });
```
https://mongoosejs.com/docs/guide.html#statics

#6.25
delete

1. Delete Video êµ¬í˜„
2. DeleteëŠ” Removeë¥¼ ëŒ€ì²´í•˜ë©° ì¶©ë¶„í•œ ì´ìœ ê°€ ìˆì§€ ì•Šì€ ì´ìƒ Deleteë¥¼ ì‚¬ìš©

Model.findOneAndDelete()
Model.findOneAndRemove()

ì´ ë‘˜ì€ ì •ë§ ì•½ê°„ì˜ ì°¨ì´ê°€ ìˆëŠ”ë° ëŒ€ë¶€ë¶„ì˜ ìƒí™©ì—ì„œ íƒ€ë‹¹í•œ ì´ìœ ê°€ ì—†ëŠ” í•œ
deleteë¥¼ ì‚¬ìš©í•˜ë¼ê³  ë˜ì–´ ìˆìŒ.
https://www.zerocho.com/category/MongoDB/post/579ecb1fc097d015000404dd

ì—¬ê¸° ê¸€ì„ ì½ì–´ë³´ë‹ˆ ëª½ê³  dbëŠ” ë¡¤ë°±ì´ ì•ˆë˜ì„œ removeë¥¼ í•˜ë©´ ë‹¤ì‹œ ë˜ëŒë¦´ ìˆ˜ ì—†ê¸°ì—
removeë³´ë‹¤ deleteë¥¼ ì‚¬ìš©í•˜ë¼ê³  ê¶Œì¥í•˜ëŠ”ë“¯

#6.26
Search
1. Model.sort()ë¡œ ì •ë ¬ ë°©ì‹ ë³€ê²½
2. Search êµ¬í˜„
3. get ë©”ì†Œë“œì—ì„œ form ê°’ì„ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ì„œëŠ” req.query ì´ìš©

Query.prototype.sort()
ì •ë ¬ ìˆœì„œë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. ê°œì²´ê°€ ì „ë‹¬ë˜ë©´ í—ˆìš©ë˜ëŠ” ê°’ì€ asc, desc, ì˜¤ë¦„ì°¨ìˆœ, ë‚´ë¦¼ì°¨ìˆœ, 1 ë° -1ì…ë‹ˆë‹¤.
https://mongoosejs.com/docs/api.html#query_Query-sort

req.query
ë¼ìš°íŠ¸ ì•ˆì— query string parameterë¥¼ í¬í•¨í•˜ê³  ìˆëŠ” ê°ì²´ë¡œ, URLì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ë•Œ ì£¼ë¡œ ì‚¬ìš©í•œë‹¤.
ì˜ˆ) ?keyword="food" => {keyword: "food"}
query parseê°€ ë¹„í™œì„±í™”ë¡œ ì„¤ì •ë˜ë©´ ë¹ˆ ê°ì²´ {}ì´ê³ , ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ êµ¬ì„±ëœ query parseì˜ ê²°ê³¼ì…ë‹ˆë‹¤.
https://expressjs.com/ko/api.html#req.query

#6.27
Search
1. Model.find()ë¥¼ í†µí•œ Search
2. ì˜¤í¼ë ˆì´í„°ë¥¼ í†µí•œ Model.find()ì˜ ê³ ë„í™” (mongoDB)
  =>ì •ê·œì‹ì„ í†µí•´ì„œ searchê¸°ëŠ¥ì„ ì •êµí•˜ê²Œ.

Model.find()
documentsë¥¼ ì°¾ìŠµë‹ˆë‹¤. (findOneê³¼ ë‹¤ë¥´ê²Œ ì „ì²´ documentë¥¼ ì°¾ìŠµë‹ˆë‹¤.)
MongooseëŠ” ëª…ë ¹ì´ ì „ì†¡ë˜ê¸° ì „ì— ëª¨ë¸ì˜ ìŠ¤í‚¤ë§ˆì™€ ì¼ì¹˜í•˜ë„ë¡ í•„í„°ë¥¼ ìºìŠ¤íŒ…í•©ë‹ˆë‹¤.
https://mongoosejs.com/docs/api.html#model_Model.find

ì •ê·œí‘œí˜„ì‹
https://www.regexpal.com

ëª½ê³ DB regex ($regex)
ëª½ê³ DBì—ì„œ ì •ê·œí‘œí˜„ì‹ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” í‚¤ì›Œë“œ
ì¿¼ë¦¬ì˜ íŒ¨í„´ ì¼ì¹˜ ë¬¸ìì—´ì— ëŒ€í•œ ì •ê·œì‹ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.
https://docs.mongodb.com/manual/reference/operator/query/regex

RegExp mdn
RegExp ìƒì„±ìëŠ” íŒ¨í„´ì„ ì‚¬ìš©í•´ í…ìŠ¤íŠ¸ë¥¼ íŒë³„í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/RegExp

RegExp ì‚¬ìš© ë°©ë²•
RegExp ê°ì²´ëŠ” ë¦¬í„°ëŸ´ í‘œê¸°ë²•ê³¼ ìƒì„±ìë¡œì¨ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ë¦¬í„°ëŸ´ í‘œê¸°ë²•ì˜ ë§¤ê°œë³€ìˆ˜ëŠ” ë‘ ë¹—ê¸ˆìœ¼ë¡œ ê°ì‹¸ì•¼ í•˜ë©° ë”°ì˜´í‘œë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
ìƒì„±ì í•¨ìˆ˜ì˜ ë§¤ê°œë³€ìˆ˜ëŠ” ë¹—ê¸ˆìœ¼ë¡œ ê°ì‹¸ì§€ ì•Šìœ¼ë‚˜ ë”°ì˜´í‘œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
```
/ab+c/i ë¥¼ ì•„ë˜ RegExp ìƒì„±ìë¥¼ ì´ìš©í•´ì„œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
new RegExp(/ab+c/, 'i') // ë¦¬í„°ëŸ´ í‘œê¸°ë²•
new RegExp('ab+c', 'i') // ìƒì„±ì í•¨ìˆ˜

#7.0
Create User model.

#7.2
hash password í•´ì‹œí™”
í•´ì‹± ->ì…ë ¥ê°’ì„ë„£ìœ¼ë©´ ì¶œë ¥ê°’ì´ ë‚˜ì˜¨ë‹¤
 => ì¶œë ¥ê°’ìœ¼ë¡œ ì…ë ¥ê°’ì„ ì–»ì§€ëª»í•œë‹¤.
 => ê°™ì€ì…ë ¥ê°’ìœ¼ë¡œ í•­ìƒ ê°™ì€ ì¶œë ¥ê°’ì´ë‚˜ì˜¨ë‹¤
npm i bcrypt ìœ¼ë¡œ ì„¤ì¹˜í•œë‹¤.
ëª¨ë¸ì˜ pre(save)ê¸°ëŠ¥ì„ ì´ìš©í•´ dbì— ì €ì¥í•˜ê¸°ì „ì— í•´ì‹±í•œë‹¤.
userSchema.pre("save", async function () {
  this.password = await bcrypt.hash(this.password, 5);
});
thisëŠ” ìœ ì €ê°€ ì…ë ¥í•œ ë°ì´í„°ë¥¼ ë§í•œë‹¤.
saltRounds => ëª‡ë²ˆ í•´ì‹±í• ê²ƒì¸ì§€ ì •í•˜ëŠ”

í•´ì‹œë¥¼ ì´ìš©í•´ í•´í‚¹ê³µê²©í•˜ëŠ” rainbow tableì´ìˆëŠ”ë°, bcryptì—ì„œ ë§‰ì•„ì¤„ê²ƒì´ë‹¤.

#7.3
Form Validation

$or
$or ì—°ì‚°ìëŠ” ë‘˜ ì´ìƒì˜ ì¡°ê±´ì— ëŒ€í•´ ë…¼ë¦¬ì  OR ì—°ì‚°ì„ ìˆ˜í–‰í•˜ê³  ì¡°ê±´ ì¤‘ í•˜ë‚˜ ì´ìƒì„ ì¶©ì¡±í•˜ëŠ” ë¬¸ì„œë¥¼ ì„ íƒí•©ë‹ˆë‹¤.

// ì˜ˆì‹œ
```
db.inventory.find( { $or: [ { quantity: { $lt: 20 } }, { price: 10 } ] } )

```
https://docs.mongodb.com/manual/reference/operator/query/or/#mongodb-query-op.-or

#7.4
Status Codes
Status Codes 400ì„ ë Œë”ë§í• ë•Œ ê°™ì´ ë³´ë‚´ì£¼ë©´
ë¸Œë¼ìš°ì €ê°€ ë°©ë¬¸ ëª©ë¡ì„ ì €ì¥í• ë•Œ í•˜ì§€ì•ŠëŠ”ë‹¤.

ìƒíƒœì½”ë“œ
- 200(OK): ì„œë²„ê°€ ìš”ì²­ì„ ì œëŒ€ë¡œ ì²˜ë¦¬í–ˆë‹¤ëŠ” ëœ»ì´ë‹¤. ì´ëŠ” ì£¼ë¡œ ì„œë²„ê°€ ìš”ì²­í•œ í˜ì´ì§€ë¥¼ ì œê³µí–ˆë‹¤ëŠ” ì˜ë¯¸ë¡œ ì“°ì¸ë‹¤.
- 400(Bad Request): ì„œë²„ê°€ ìš”ì²­ì˜ êµ¬ë¬¸ì„ ì¸ì‹í•˜ì§€ ëª»í•  ë•Œ ë°œìƒí•œë‹¤. í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ ë¬¸ì œê°€ ìˆì„ ë•Œ ì£¼ë¡œ ë°œìƒí•œë‹¤.
- 404(Not Found): ì„œë²„ê°€ ìš”ì²­í•œ í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ì„ ë•Œ ë°œìƒí•œë‹¤. ì„œë²„ì— ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í˜ì´ì§€ì— ëŒ€í•œ ìš”ì²­ì´ ìˆì„ ê²½ìš° ì„œë²„ëŠ” ì´ ì½”ë“œë¥¼ ì œê³µí•œë‹¤.
https://ko.wikipedia.org/wiki/HTTP_%EC%83%81%ED%83%9C_%EC%BD%94%EB%93%9C

res.status(code)
responseì— ëŒ€í•œ HTTP ìƒíƒœë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. (statusë¥¼ ì„¤ì •í•œë‹¤.)
https://expressjs.com/ko/api.html#res.status
https://nodejs.org/api/http.html#http_response_statuscode

#7.6
compare hash password 
bcryptë¥¼ ì´ìš©í•´ì„œ ë¹„ë°€ë²ˆí˜¸ ë¹„êµ

password: ìœ ì €ê°€ ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸
user.passwordHash: DBì— í•´ì‹œí™”ë˜ì„œ ì €ì¥ëœ ë¹„ë°€ë²ˆí˜¸
```
const match = await bcrypt.compare(password, user.passwordHash);
```
https://www.npmjs.com/package/bcrypt

#7.7
session

npm i express-session

1. ë¸Œë¼ìš°ì ¸ ì„œë²„ì— ì ‘ê·¼
2. ì„œë²„ê°€ ë¸Œë¼ìš°ì ¸ì—ê²Œ ì¿ í‚¤(ì„¸ì…˜id)ë¥¼ ì¤€ë‹¤.
3. ë¸Œë¼ìš°ì ¸ê°€ ì„œë²„ì— ë‹¤ì‹œ ì ‘ê·¼í•  ë•Œ 2.ì—ì„œ ë°›ì€ ì¿ í‚¤(ì„¸ì…˜id)ë¥¼ í•¨ê»˜ ê±´ëƒ„.
4. ì„œë²„ëŠ” ì¿ í‚¤(ì„¸ì…˜id)ë¥¼ í†µí•´ ë¸Œë¼ìš°ì ¸ë¥¼ êµ¬ë¶„ í•  ìˆ˜ ìˆë‹¤.

ì„¸ì…˜ì€ ì˜¤ë¸Œì íŠ¸ë¼ ìš°ë¦¬ê°€ ì •ë³´ë¥¼ ë¶™ì¼ìˆ˜ìˆë‹¤.
ex) req.session.user = user;
...
ì¦‰ ìœ ì €ë¥¼ ë¡œê·¸ì¸ì‹œí‚¤ëŠ”ê²ƒì€ ìš°ë¦¬ê°€ req.session ì˜¤ë¸Œì íŠ¸ ì•ˆì—
ì •ë³´ë¥¼ ë„£ëŠ” ê²ƒì´ë‹¤.

express-session
Expressìš© ì„¸ì…˜ ë¯¸ë“¤ì›¨ì–´
ì„¸ì…˜ ë°ì´í„°ëŠ” ì¿ í‚¤ ìì²´ì— ì €ì¥ë˜ì§€ ì•Šê³  ì„¸ì…˜ IDì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤. ì„¸ì…˜ ë°ì´í„°ëŠ” ì„œë²„ ì¸¡ì— ì €ì¥ë©ë‹ˆë‹¤.
npm i express-session
https://www.npmjs.com/package/express-session

Session ì‚¬ìš© ì˜ˆì‹œ
https://github.com/expressjs/session#example

req.session.id ë˜ëŠ” req.sessionID
ë¸Œë¼ìš°ì €ê°€ requestí•  ë•Œ ê°™ì´ ë³´ë‚´ëŠ” session id

resave (ë³€ê²½ ì‚¬í•­ì´ ì—†ì–´ë„ ì €ì¥)
requestí•˜ëŠ” ë™ì•ˆ ì„¸ì…˜ì´ ìˆ˜ì •ë˜ì§€ ì•Šì€ ê²½ìš°ì—ë„ ì„¸ì…˜ì´ ì„¸ì…˜ ì €ì¥ì†Œì— ë‹¤ì‹œ ì €ì¥ë˜ë„ë¡ í•©ë‹ˆë‹¤.
https://github.com/expressjs/session#resave

saveUninitialized (ì„¸ì…˜ ì´ˆê¸°í™” ì „ì—ë„ ì €ì¥)
"ì´ˆê¸°í™”ë˜ì§€ ì•Šì€" ì„¸ì…˜ì„ ì €ì¥ì†Œì— ê°•ì œë¡œ ì €ì¥í•©ë‹ˆë‹¤.
https://github.com/expressjs/session#saveuninitialized

#7.8
ì„¸ì…˜ part2

ì„¸ì…˜ì€ ì„œë²„ì¸¡ì—ì„œ ì œê³µí•´ì£¼ëŠ” ë°ì´í„°, ì¿ í‚¤ëŠ” í´ë¼ì´ì–¸íŠ¸ì¸¡ì—ì„œ ì €ì¥í•˜ê³  ì‚¬ìš©í•˜ëŠ” ë°ì´í„°
  req.sessiontStore() ì‚¬ìš©í–ˆì„ë•Œ í•œë²ˆì€ undefinedê°€ ë‚˜ì˜¨ ì´ìœ ê°€
  ì„¸ì…˜ì€ ì„œë²„ì—ì„œ ë§Œë“¤ì–´ì¤˜ì•¼ í•˜ëŠ”ë° í´ë¼ì´ì–¸íŠ¸ê°€ ì²« ìš”ì²­ë•Œ ì„¸ì…˜ì„ ê°€ì§€ê³ ìˆì„ë¦¬ ì—†ìœ¼ë‹ˆ
  undefinedì´ ë‚˜ì˜¨ê±°ê³  ê·¸ ì´í›„ ìš”ì²­ë¶€í„´ ì²«ë²ˆì§¸ ìš”ì²­ë•Œ ì„¸ì…˜ì„ ë§Œë“¤ì–´ì„œ ë„˜ê²¨ì¤¬ìœ¼ë‹ˆ
  í´ë¼ì´ì–¸íŠ¸ê°€ í•´ë‹¹ ê°’ì„ ì¿ í‚¤ì— ì €ì¥í•˜ê³  ë§¤ ìš”ì²­ë•Œë§ˆë‹¤ ì„œë²„ì—ê²Œ ì „ë‹¬
ì„¸ì…˜ì€ ì„œë²„ê°€ ë§Œë“¤ì–´ì„œ ì œê³µí•´ì£¼ë‹¤ë³´ë‹ˆ ì„œë²„ê°€ ì¬ë¶€íŒ…ë˜ë©´ ì´ˆê¸°í™” ëœë‹¤.
  => (ê·¸ë˜ì„œ DBì— ì €ì¥í•´ì„œ ê´€ë¦¬ë¥¼ í•œë‹¤ëŠ” ì†Œë¦¬. ì‹¤ ìš´ì˜ì—ì„  ì„œë²„ê°€ êº¼ì§€ëŠ” ì¼ì€ ì—†ìœ¼ë‹ˆê¹.)
ì„¸ì…˜ì˜ ê°’ì€ ì„œë²„ê°€ ë§Œë“¤ì–´ì£¼ëŠ” ê³ ìœ ê°’ì´ë‹¤ë³´ë‹ˆ í•´ë‹¹ ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìš”ì²­í•œ ê±´ì— ëŒ€í•´ ìœ ì €ë¥¼ íŠ¹ì •ì§€ì„ ìˆ˜ ìˆë‹¤
  ==>ì„œë²„ê°€ ì„¸ì…˜ì„ ìƒì„±í•œ ê¸°ì ì€ middlewareë¡œ express-sessionì„ ì¶”ê°€í–ˆì„ë•Œë¶€í„° ìƒì„±ë¨.

====>>
ì¦‰, ë¸Œë¼ìš°ì ¸ì—ì„œ ì„œë²„ì— ë¡œê·¸ì¸ ìš”ì²­ì„ í•´ì„œ ë¡œê·¸ì¸ì´ ë˜ë©´ ì„œë²„ëŠ” ì„¸ì…˜idë¥¼ responseí•´ì£¼ê³ 
ë¸Œë¼ìš°ì ¸ëŠ” ì¿ í‚¤ìŠ¤í† ë¦¬ì§€ì— ê·¸ ì„¸ì…˜idë¥¼ ë³´ê´€í•˜ê³  ìˆë‹¤ê°€ ì´í›„ ë‹¤ì‹œ ì„œë²„ì— ë°©ë¬¸í•  ì‹œì—ëŠ” ê·¸ ì„¸ì…˜
idë§Œ ë³´ì—¬ì£¼ë©´ ìë™ìœ¼ë¡œ ë¡œê·¸ì¸ë˜ê²Œ í•´ì¤˜ì„œ ê³„ì† ë¡œê·¸ì¸í•  ìˆ˜ê³ ë¥¼ ëœì–´ì¤€ë‹¤ëŠ” ê²ƒì´ê² êµ°ìš”.

#7.9~10
res.locals ëŠ” ì „ì—­ë²ˆìˆ˜ ì˜¤ë¸Œì íŠ¸ì´ë‹¤.
pugì—ì„œëŠ” sessionì„ ë°”ë¡œ ì½ì§€ëª»í•˜ì§€ë§Œ, localsëŠ” ì½ì„ìˆ˜ìˆë‹¤.

res.locals

request ë²”ìœ„ê°€ ì§€ì •ëœ response ë¡œì»¬ ë³€ìˆ˜ë¥¼ í¬í•¨í•˜ëŠ” ê°ì²´ì´ë¯€ë¡œ request, response ì£¼ê¸°ë™ì•ˆ ë Œë”ë§ëœ viewì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
(Pugë‚˜ EJSê°™ì€ í…œí”Œë¦¿ ì—”ì§„ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤ëŠ” ì˜ë¯¸)
ì´ ì†ì„±ì€ request path, ì¸ì¦ëœ ì‚¬ìš©ì, ì‚¬ìš©ì ì„¤ì • ë“±ê³¼ ê°™ì€ request levelì˜ ì •ë³´ë¥¼ ë…¸ì¶œí•˜ëŠ” ë° ìœ ìš©í•©ë‹ˆë‹¤.
```
// ì‚¬ìš© ì˜ˆì‹œ
app.use(function (req, res, next) {
res.locals.user = req.user
res.locals.authenticated = !req.user.anonymous
next()
})
```
https://expressjs.com/ko/api.html#res.locals

#7.12
MongoStore

ì„¸ì…˜
ì„¸ì…˜idëŠ” ì¿ í‚¤ì— ì €ì¥ë¼ì§€ë§Œ ì„¸ì…˜ë°ì´í„°ëŠ” ì„œë²„ì‚¬ì´ë“œì— ì €ì¥ë€ë‹¤.
ë””í´íŠ¸ë¡œ ì§€ì •ëœ ì„œë²„ì‚¬ì´ë“œ ìŠ¤í† ë¦¬ì§€ëŠ”MemoryStoreì´ë‹¤.
 => ì„œë²„ ë©”ëª¨ë¦¬ì— ì €ì¥ë¼ê¸° ë•Œë¬¸ì— ì„œë²„ë¥¼ ì¬ì‹œì‘ í• ë•Œë§ˆë‹¤ ë©”ëª¨ë¦¬ê°€ ì§€ì›Œì§„ë‹¤.
 =>ê·¸ë˜ì„œ session store(ë°ì´í„°ë² ì´ìŠ¤)ì— ì„¸ì…˜ì„ ì €ì¥í•´ì•¼í•œë‹¤.

MongoDBì˜ ê²½ìš° connect-mongoë¥¼ ì‚¬ìš©í•œë‹¤. => npm i connect-mongo
=>ì„¸ì…˜ì„ mongodbì— ì €ì¥í•œë‹¤.

#7.13
Uninitialized Sessions
ë°©ë¬¸í•œ ëª¨ë“  ì‚¬ëŒ, ë¡œê·¸ì¸í•˜ì§€ì•Šì€ì‚¬ëŒ, ë´‡ì˜ sessionì„ ì €ì¥í•˜ëŠ”ê²Œ ì¢‹ì„ê¹Œ?
 =>ë¡œê·¸ì¸í•œì‚¬ëŒì˜ ì„¸ì…˜ë§Œì„ ì €ì¥í•˜ëŠ”ê²ƒì´ ì¢‹ë‹¤.

**
DB ë¯¸ë“¤ì›¨ì–´ì—ì„œ
resave: requestì—ì„œ ìƒˆë¡œ ìƒì„±ëœ sessionê³¼ ê¸°ì¡´ì— ìˆë˜ sessionì´ ë˜‘ê°™ì„ ë•Œì—ë„ ë‹¤ì‹œ ì €ì¥í•  ê²ƒì¸ê°€?
-> ëŒ€ë¶€ë¶„ì˜ ê²½ìš° false, ê³µì‹ë¬¸ì„œì—ì„œë„ falseë¥¼ ê¶Œì¥í•˜ë©° trueëŠ” deprecated ìƒíƒœ

saveUninitialized : true
 => ë”°ë¡œ ê°’ì„ ì„¤ì •í•˜ì§€ ì•Šì€ ì „ë‹¬ ë°›ì€ ë‚ ê²ƒì˜ ì„¸ì…˜ì„ ì¦‰ì‹œ Storeì— ì €ì¥ í›„ ì„¸ì…˜ ì£¼ì¸ì—ê²Œ ì¿ í‚¤ë¥¼ (ë‹µì¥í•˜ë“¯) ë„˜ê²¨ ì¤€ë‹¤.

saveUninitialized : false
  => req.session ì† ê°’ì„ ìˆ˜ì •í•˜ëŠ” ê·¸ ìˆœê°„ì—(session.user=user) ì„¸ì…˜ì„ Storeì— ì €ì¥ í›„ ê·¸ì œì•¼ ì¿ í‚¤ë¥¼ ì „ë‹¬í•œë‹¤.
  => ì„¸ì…˜ì„ ìˆ˜ì •í•˜ëŠ” í–‰ìœ„ ìì²´ê°€ initialize(ì´ˆê¸°í™”)í•˜ëŠ”ê²ƒì´ë‹¤.
  => ì¦‰ ë¡œê·¸ì¸í• ë•Œ ì„¸ì…˜ì— ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ”í–‰ìœ„ì—ì„œë§Œ DBì— ì„¸ì…˜ì €ì¥ì´ ë€ë‹¤.

#7.14
Expiration and Secrets

1. .env íŒŒì¼ ë§Œë“¤ê¸°
2. env íŒŒì¼ì„ .gitignoreì— ì¶”ê°€í•˜ê¸°. (gitì— ì—…ë¡œë“œ í•˜ì§€ ì•Šê¸° ìœ„í•´)
3. ë¹„ë°€ë¡œ í•´ì•¼ í•˜ëŠ” stringì„ process.env.[í™˜ê²½ë³€ìˆ˜ì´ë¦„]ìœ¼ë¡œ ë°”ê¾¸ê¸°


Set-Cookie
Set-Cookie HTTP ì‘ë‹µ í—¤ë”ëŠ” ì„œë²„ì—ì„œ ì‚¬ìš©ì ë¸Œë¼ìš°ì €ì— ì¿ í‚¤ë¥¼ ì „ì†¡í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.
https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Set-Cookie

ì¿ í‚¤ì— ì„¤ì •ê°€ëŠ¥í•œ ì˜µì…˜
Domain
ì¿ í‚¤ê°€ ì ìš©ë˜ì–´ì•¼ í•˜ëŠ” í˜¸ìŠ¤íŠ¸ë¥¼ ì§€ì •.

Expires
HTTP íƒ€ì„ìŠ¤í…œí”„ë¡œ ê¸°ë¡ëœ ì¿ í‚¤ì˜ ìµœëŒ€ ìƒì¡´ ì‹œê°„(ìˆ˜ëª…).

Max-Age
ì¿ í‚¤ê°€ ë§Œë£Œë  ë•Œ ê¹Œì§€ì˜ ì‹œê°„ (ë°€ë¦¬ì„¸ì»¨ë“œ)

secret
ì´ê²ƒì€ ì„¸ì…˜ ID ì¿ í‚¤ì— ì„œëª…í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ë¹„ë°€ì…ë‹ˆë‹¤.
https://www.npmjs.com/package/express-session

COOKIE_SECRETì— ë„£ì„ ëœë¤ ë¬¸ìì—´ ìƒì„± ì‚¬ì´íŠ¸
https://randomkeygen.com/

#7.15
Environment Variables í™˜ê²½ë³€ìˆ˜

dotenv
DotenvëŠ” .env íŒŒì¼ì—ì„œ process.envë¡œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ë¡œë“œí•˜ëŠ” ì œë¡œ ì¢…ì†ì„± ëª¨ë“ˆì…ë‹ˆë‹¤.
npm i dotenv

í”„ë¡œì íŠ¸ì—ì„œ ë ìˆ˜ìˆëŠ”í•œ ê°€ì¥ë¨¼ì € dotenvë¥¼ importí•´ì¤˜ì•¼í•œë‹¤.
 => ì´ë²ˆí”„ë¡œì íŠ¸ëŠ” init.jsê°€ ê°€ì¥ë¹ ë¥´ë‹¤.
 =>importë°©ë²•ì€ ë‘ê°€ì§€ìˆë‹¤.
 =>ë°©ë²•1. require(dotenvê°€í•„ìš”í•œ ëª¨ë“ íŒŒì¼ì—)
    ë°©ë²•2. import "dotenv/config"
https://www.npmjs.com/package/dotenv


#7.16
Github Login

1.ì‚¬ìš©ìë¥¼ githubë¡œ ë³´ë‚¸ë‹¤.
2.ì‚¬ìš©ìê°€ githubë¡œê·¸ì¸í•˜ê³ , githubëŠ” ìœ ì €ë¥¼ ì›¹ì‚¬ì´íŠ¸ë¡œ redirectì‹œí‚¨ë‹¤(í† í°,ìœ ì € ì •ë³´ë‘ê°™ì´)
3.í† í°ì„ ì´ìš©í•˜ì—¬ ìœ ì €ì •ë³´ë¥¼ ì–»ëŠ”ë‹¤.


https://github.com/login/oauth/authorize?client_id=ì…ë ¥ê°’&allow_signup=false

Authorizing OAuth Apps
ë‹¤ë¥¸ ì‚¬ìš©ìê°€ OAuth ì•±ì„ ìŠ¹ì¸í•˜ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
GitHubì˜ OAuth êµ¬í˜„ì€ ì›¹ ë¸Œë¼ìš°ì €ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ ê¶Œí•œì´ ì—†ëŠ” ì•±ì— ëŒ€í•œ í‘œì¤€ ì¸ì¦ ì½”ë“œ ë¶€ì—¬ ìœ í˜• ë° OAuth 2.0 ì¥ì¹˜ ì¸ì¦ ë¶€ì—¬ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.

Web application flow
ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ íë¦„: ë¸Œë¼ìš°ì €ì—ì„œ ì‹¤í–‰ë˜ëŠ” í‘œì¤€ OAuth ì•±ì— ëŒ€í•´ ì‚¬ìš©ìì—ê²Œ ê¶Œí•œì„ ë¶€ì—¬í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
ì•± ì‚¬ìš©ìì—ê²Œ ê¶Œí•œì„ ë¶€ì—¬í•˜ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ íë¦„ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
1. ë¡œê·¸ì¸í•˜ë ¤ëŠ” ì‚¬ì´íŠ¸ì—ì„œ ìœ ì €ì˜ GitHub identityë¥¼ requestí•˜ê¸° ìœ„í•´ ìœ ì €ë¥¼ GitHub í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ì‹œí‚µë‹ˆë‹¤.
2. ìœ ì €ëŠ” ë¦¬ë‹¤ì´ë ‰íŠ¸ëœ GitHubì—ì„œ ìŠ¹ì¸ì„ í•˜ê³ , GitHubì— ì˜í•´ ë‹¤ì‹œ ë¡œê·¸ì¸í•˜ë ¤ëŠ” ì‚¬ì´íŠ¸ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ë©ë‹ˆë‹¤.
3. ë¡œê·¸ì¸ í•˜ë ¤ëŠ” ì‚¬ì´íŠ¸ëŠ” ìœ ì €ì˜ ì•¡ì„¸ìŠ¤ í† í°ì„ í†µí•´ APIì— ì ‘ê·¼í•©ë‹ˆë‹¤.
https://docs.github.com/en/developers/apps/building-oauth-apps/authorizing-oauth-apps

ê¹ƒí—ˆë¸Œ OAuth Apps Setting
GitHub APIë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ë“±ë¡í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì…ë‹ˆë‹¤.
https://github.com/settings/developers

Scopes for OAuth Apps (OAuth ì•±ì˜ ë²”ìœ„)
https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps

Creating an OAuth App (OAuthì•± ë§Œë“¤ê¸°)
https://docs.github.com/en/developers/apps/building-oauth-apps/creating-an-oauth-app

#7.17

ê¸´ URLì€ ê·¸ëŒ€ë¡œ ì“°ëŠ”ê²Œì•„ë‹ˆë¼, ë³€ìˆ˜ë¥¼ë§Œë“¤ì–´ ê´€ë¦¬í•˜ì.


&scope=read:user
&scope=read:user user:email

Scopes for OAuth Apps
OAuth ì•±ì€ ì´ˆê¸° ë¦¬ë””ë ‰ì…˜ì—ì„œ ë²”ìœ„ë¥¼ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. %20ì„ ì‚¬ìš©í•˜ì—¬ ê³µë°±ìœ¼ë¡œ êµ¬ë¶„í•˜ì—¬ ì—¬ëŸ¬ ë²”ìœ„ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
// ì‚¬ìš© ì˜ˆì‹œ
```
https://github.com/login/oauth/authorize?client_id=...&scope=user%20repo_deployment
```
https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps

URLSearchParams
URLSearchParams ì¸í„°í˜ì´ìŠ¤ëŠ” URLì˜ ì¿¼ë¦¬ ë¬¸ìì—´ì— ëŒ€í•´ ì‘ì—…í•  ìˆ˜ ìˆëŠ” ìœ í‹¸ë¦¬í‹° ë©”ì„œë“œë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
https://developer.mozilla.org/ko/docs/Web/API/URLSearchParams

URLSearchParams.toString()
toString() ì€ URLSearchParams ì¸í„°í˜ì´ìŠ¤ì˜ ë©”ì†Œë“œë¡œì„œ, URLì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì¿¼ë¦¬ ë¬¸ìì—´ì„ ë¦¬í„´í•©ë‹ˆë‹¤.
https://developer.mozilla.org/ko/docs/Web/API/URLSearchParams/toString

https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps

#7.18

ê¹ƒí—ˆë¸Œì—ì„œ ë³´ë‚´ì¤€ ì½”ë“œë¡œ access_tokenì´ë€ê²ƒì„ ë°›ì•„ì•¼í•˜ëŠ”ë°,
ê·¸ë¥¼ìœ„í•´ POST Requestë¥¼ ë³´ë‚´ì•¼í•œë‹¤.
POST reqeustë¥¼ ë³´ë‚´ëŠ”ë°ëŠ”, fetch()ë¥¼ ì“°ë©´ ì¢‹ì€ë°(), ì„œë²„ì—ëŠ” ì—†ê³  ë¸Œë¼ìš°ì €ì—ë§Œ ìˆëŠ” ê¸°ëŠ¥ì´ë‹¤.
 =>node-fetchë¼ëŠ” íŒ¨í‚¤ì§€ë¡œ ì“¸ìˆ˜ìˆë‹¤.

Users are redirected back to your site by GitHub

ì‚¬ìš©ìê°€ ìš”ì²­ì„ ìˆ˜ë½í•˜ë©´ GitHubëŠ” ì½”ë“œ ë§¤ê°œë³€ìˆ˜ì˜ ì„ì‹œ codeì™€ ìƒíƒœ ë§¤ê°œë³€ìˆ˜ì˜ ì´ì „ ë‹¨ê³„ì—ì„œ ì œê³µí•œ stateë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ì´íŠ¸ë¡œ ë‹¤ì‹œ ë¦¬ë””ë ‰ì…˜í•©ë‹ˆë‹¤.

POST Requestë¥¼ í•  ë•Œ, ë°˜ë“œì‹œ í•„ìš”í•œ íŒŒë¼ë¯¸í„°ë“¤
client_id, client_secret, code
```
POST https://github.com/login/oauth/access_token
```
https://docs.github.com/en/developers/apps/building-oauth-apps/authorizing-oauth-apps#2-users-are-redirected-back-to-your-site-by-github

#7.19
node-fetch
JSì™€ NodeJSëŠ” ë‹¤ë¥¸ í”Œë«í¼ì´ê¸°ë•Œë¬¸ì— fetchë¥¼ ì“°ë ¤ë©´ node-fetchë¥¼ ì¨ì•¼í•œë‹¤.
npm i node-fetch

githubì—ì„œ ë°›ì€ ì½”ë“œë¡œ access_tokenì„ ì–»ì„ìˆ˜ìˆëŠ”ë°, GitHub APIë¥¼ ì´ìš©í•´ user ì •ë³´ë¥¼ ì–»ì„ìˆ˜ìˆë‹¤.

[2022.01.24] HTTP headers (fetchì˜ headerì˜ ì—­í• )

HTTP headersëŠ” ëŠ” í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ê°€ request(or response)ë¡œ ë¶€ê°€ì ì¸ ì •ë³´ë¥¼ ì „ì†¡í•  ìˆ˜ ìˆë„ë¡ í•´ì¤ë‹ˆë‹¤

Accept
ëŒë ¤ì¤„ ë°ì´í„° íƒ€ì…ì— ëŒ€í•´ ì„œë²„ì—ê²Œ ì•Œë ¤ì£¼ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤
MIME íƒ€ì…ì…ë‹ˆë‹¤
(ğŸ“ŒMIME typeì´ë€ ì›¹ì—ì„œ ì‚¬ìš©ë˜ëŠ” í™•ì¥ìë¼ê³  ìƒê°í•˜ì‹œë©´ ë˜ë©°
type/subtypeìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤)

Authorization
ë³´í˜¸ëœ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì ‘ê·¼ì„ í—ˆìš©í•˜ì—¬ ì„œë²„ë¡œ User agentë¥¼ ì¸ì¦í•˜ëŠ” ìê²©ì¦ëª…ì„ ë³´ë‚´ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤

[ì¶œì²˜]
HTTP headers: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers
MIME tyeps: https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types

****
Error [ERR_REQUIRE_ESM]: require() of ES Module ì˜¤ë¥˜ ë°œìƒ ì‹œ ë‘ ê°€ì§€ ë°©ë²• ì¤‘ í•˜ë‚˜ë¡œ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

1. node-fetch 3ë²„ì „ì´ ì•„ë‹Œ 2ë²„ì „ìœ¼ë¡œ ë‹¤ìš´ê·¸ë ˆì´ë“œëœ ë²„ì „ì„ ì„¤ì¹˜í•´ì„œ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
npm i node-fetch@2.6.1 (ê°•ì˜ê³¼ ê°™ì€ ë²„ì „)
https://www.npmjs.com/package/node-fetch

2. cross-fetch ì‚¬ìš© (CommonJS, ES6 ëª¨ë“ˆ, Typescriptë“±ì—ì„œë„ ì‚¬ìš©ê°€ëŠ¥)
node-fetchëŒ€ì‹  ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” cross-fetch íŒ¨í‚¤ì§€ë¥¼ í†µí•´ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. node-fetchì™€ ì‚¬ìš©ë²•ì€ ë™ì¼í•©ë‹ˆë‹¤.
Node, ë¸Œë¼ìš°ì € ë° React Nativeìš© ë²”ìš© WHATWG Fetch API.
npm i cross-fetch
```
import fetch from 'cross-fetch';

fetch(...)
```
https://www.npmjs.com/package/cross-fetch

node-fetch ë²„ì „3 ë¬¸ì œ
v3ì˜ node-fetchëŠ” ESM ì „ìš© ëª¨ë“ˆì…ë‹ˆë‹¤. require()ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ESMìœ¼ë¡œ ì „í™˜í•  ìˆ˜ ì—†ëŠ” ê²½ìš° CommonJSì™€ í˜¸í™˜ë˜ëŠ” v2ë¥¼ ì‚¬ìš©í•˜ì‹­ì‹œì˜¤. ì¤‘ìš”í•œ ë²„ê·¸ ìˆ˜ì •ì€ v2ì— ëŒ€í•´ ê³„ì† ê²Œì‹œë©ë‹ˆë‹¤.

Use the access token to access the API
ì•¡ì„¸ìŠ¤ í† í°ì„ ì‚¬ìš©í•˜ë©´ ìœ ì €ë¥¼ ëŒ€ì‹ í•´ APIì— ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```
Authorization: token OAUTH-TOKEN
GET https://api.github.com/user
```
https://docs.github.com/en/developers/apps/building-oauth-apps/authorizing-oauth-apps#3-use-the-access-token-to-access-the-api
****

#7.20

Github REST API (User)
ì‚¬ìš©ì APIë¥¼ ì‚¬ìš©í•˜ë©´ ì¸ì¦ëœ ì‚¬ìš©ìì— ëŒ€í•œ ê³µê°œ ë° ë¹„ê³µê°œ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
https://docs.github.com/en/rest/reference/users

Get the authenticated user
ì¸ì¦ëœ ì‚¬ìš©ìê°€ ê¸°ë³¸ ì¸ì¦ ë˜ëŠ” ì‚¬ìš©ì ë²”ìœ„ì˜ OAuthë¥¼ í†µí•´ ì¸ì¦ë˜ë©´ ì‘ë‹µì— ê³µê°œ ë° ë¹„ê³µê°œ í”„ë¡œí•„ ì •ë³´ê°€ ë‚˜ì—´ë©ë‹ˆë‹¤. ì¸ì¦ëœ ì‚¬ìš©ìê°€ ì‚¬ìš©ì ë²”ìœ„ ì—†ì´ OAuthë¥¼ í†µí•´ ì¸ì¦ëœ ê²½ìš° ì‘ë‹µì—ëŠ” ê³µê°œ í”„ë¡œí•„ ì •ë³´ë§Œ ë‚˜ì—´ë©ë‹ˆë‹¤.

Add an email address for the authenticated user
https://docs.github.com/en/rest/reference/users#add-an-email-address-for-the-authenticated-user

List public email addresses for the authenticated user
ì¸ì¦ëœ ì‚¬ìš©ìì˜ ê³µê°œ ì´ë©”ì¼ ì£¼ì†Œ ë‚˜ì—´
https://docs.github.com/en/rest/reference/users#list-public-email-addresses-for-the-authenticated-user

#7.21
ë¡œê·¸ì¸ ê·œì¹™ì„ ì–´ë–»ê²Œ ë§Œë“¤ê²ƒì¸ê°€?
=>ê¹ƒí—ˆë¸Œ emailì´ verified, primaryì´ê³ , DBì— ë˜‘ê°™ì€ emailì´ ìˆìœ¼ë©´ ë¡œê·¸ì¸ì‹œí‚¨ë‹¤.
=> DBì— ì¼ì¹˜í•˜ëŠ” ë°ì´í„°ê°€ì—†ìœ¼ë©´, ê¹ƒí—ˆë¸Œ ìœ ì €ì •ë³´ë¥¼ ì´ìš©í•´ ìœ ì €ë¥¼ ìƒì„±ì‹œí‚¤ê³ , ë¡œê·¸ì¸ì‹œí‚¨ë‹¤.

#7.22

ë¡œê·¸ì•„ì›ƒ

Session.destroy(callback)

ì„¸ì…˜ì„ íŒŒê´´í•˜ê³  req.session ì†ì„±ì„ ì„¤ì • í•´ì œí•©ë‹ˆë‹¤. ì™„ë£Œë˜ë©´ ì½œë°±ì´ í˜¸ì¶œë©ë‹ˆë‹¤.
```
req.session.destroy(function(err) {
// cannot access session here
})
```
https://www.npmjs.com/package/express-session

#7.23

ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ êµ¬í˜„í•˜ê¸° (REST API)
ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ êµ¬í˜„í•˜ì‹¤ ë¶„ë“¤ì€ ì•„ë˜ ë§í¬ë“¤ì„ ì°¸ì¡°í•˜ì‹œë©´ ë©ë‹ˆë‹¤.
êµ¬í˜„ ë°©ì‹ì€ ê¹ƒí—ˆë¸Œ ë¡œê·¸ì¸ê³¼ ê±°ì˜ ë™ì¼í•©ë‹ˆë‹¤.
https://developers.kakao.com/docs/latest/ko/kakaologin/rest-api

0. ì• í”Œë¦¬ì¼€ì´ì…˜ ë“±ë¡
https://developers.kakao.com/docs/latest/ko/getting-started/app

1. ì¸ê°€ ì½”ë“œ ë°›ê¸°
https://developers.kakao.com/docs/latest/ko/kakaologin/rest-api#request-code

2. í† í° ë°›ê¸°
https://developers.kakao.com/docs/latest/ko/kakaologin/rest-api#request-token

3. ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
https://developers.kakao.com/docs/latest/ko/kakaologin/rest-api#req-user-info

#8.0
Edit Profile

ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ìœ ì €ëŠ” edití˜ì´ì§€ì— ì ‘ê·¼í• ìˆ˜ ì—†ì–´ì•¼í•œë‹¤.
 =>ë¡œê·¸ì¸í•˜ì§€ì•Šì•˜ë‹¤ë©´, middlewares.jsì—ì„œ lcoalsì˜ userì˜¤ë¸Œì íŠ¸ëŠ” ì •ì˜ë¼ì§€ ì•Šìœ¼ë¯€ë¡œ,
  ì—ëŸ¬ê°€ ë‚œë‹¤.
  =>ë¡œê·¸ì¸í•˜ì§€ ì•Šì•˜ë‹¤ë©´ ë¹ˆ ì˜¤ë¸Œì íŠ¸ë¥¼ ëŒë ¤ì£¼ì–´ ì¼ë‹¨ ì—ëŸ¬ëŠ” ë§‰ëŠ”ë‹¤.res.locals.loggedInUser = req.session.user || {};

#8.1

Protector and Public Middlewares

ê° í˜ì´ì§€ë§ˆë‹¤ ì ‘ê·¼ ê°€ëŠ¥í•œ ì‚¬ëŒì„ ì œí•œí•´ì•¼ í•œë‹¤.
=>middlewareë¥¼ ì¶”ê°€í•˜ì—¬ ê° ë¼ìš°í„°ì— ìš©ë„ì— ë§ê²Œ ë¶™í˜€ì¤€ë‹¤.
=>all()í•¨ìˆ˜ëŠ” get.postë‘˜ë‹¤ìˆëŠ” ë¼ìš°í„°ì— ë‘˜ë‹¤ ì ìš©í• ìˆ˜ìˆê²Œ í•´ì¤€ë‹¤.

#8.2

edit Profile
POSTë¡œ ì…ë ¥ê°’ì„ ë°›ì•„ì™€ì„œ ì—…ë°ì´íŠ¸ë¥¼ í•˜ë©´
DBê°’ì€ ì—…ë°ì´íŠ¸ë¼ì§€ë§Œ, ì„¸ì…˜ì€ ì—…ë°ì´íŠ¸ë¼ì§€ ì•ŠëŠ”ë‹¤.
ì„¸ì…˜ë„ ì—…ë°ì´íŠ¸ë¥¼ í•´ì¤˜ì•¼ ë°”ë€ ê°’ì´ ë°˜ì˜ë€ user ì˜¤ë¸Œì íŠ¸ê°€
ì„¸ì…˜ì— ë“¤ì–´ê°€ê²Œ ë€ë‹¤.

Model.findByIdAndUpdate()

ë¬¸ì„œì˜ _id í•„ë“œë¡œ mongodb findAndModify ì—…ë°ì´íŠ¸ ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤. findByIdAndUpdate(id, ...)ëŠ” findOneAndUpdate({ _id: id }, ...)ì™€ ë™ì¼í•©ë‹ˆë‹¤.

```
// ì‚¬ìš© ì˜ˆì‹œ
Model.findByIdAndUpdate(id, { name: 'jason bourne' }, options, callback)

// is sent as (+íƒ€ì…ìŠ¤í¬ë¦½íŠ¸)
Model.findByIdAndUpdate(id, { $set: { name: 'jason bourne' }}, options, callback)
```
https://mongoosejs.com/docs/api.html#model_Model.findByIdAndUpdate